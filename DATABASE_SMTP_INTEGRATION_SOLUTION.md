# ุญู ุชูุงูู ุฅุนุฏุงุฏุงุช SMTP ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ููุฎุต ุงููุดููุฉ

ูุงู ุงููุธุงู ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุช SMTP ุซุงุจุชุฉ ูู ุงูููุฏ ุจุฏูุงู ูู ุงูุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ูุฐุง ูุนูู ุฃู:

1. **ุงููุดููุฉ ุงูุฃุณุงุณูุฉ**: ุงูููุงูุจ ูุง ุชุณุชุฎุฏู ุฅุนุฏุงุฏุงุช SMTP ุงููุญุฏุฏุฉ ููุง
2. **ุงูุณุจุจ**: ุงููุธุงู ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุช ุซุงุจุชุฉ ูุซู `manage@kareemamged.com`
3. **ุงููุชูุฌุฉ**: ุฌููุน ุงูุฅููููุงุช ุชุฑุณู ุจุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุงููุฏููุฉ

## ๐ง ุงูุญู ุงููุทุจู

### 1. ุฅูุดุงุก ุฎุฏูุฉ ูุฑูุฒูุฉ ูุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช SMTP

ุชู ุฅูุดุงุก `DatabaseSMTPManager` ูู `src/lib/databaseSMTPManager.ts`:

```typescript
export class DatabaseSMTPManager {
  // ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ุงูุงูุชุฑุงุถูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  static async getDefaultSMTPSettings(): Promise<DatabaseSMTPConfig | null>
  
  // ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ูุญุฏุฏุฉ ุจุงูู ID
  static async getSMTPSettingsById(id: string): Promise<DatabaseSMTPConfig | null>
  
  // ุฌูุจ ุฌููุน ุฅุนุฏุงุฏุงุช SMTP ุงููุดุทุฉ
  static async getAllActiveSMTPSettings(): Promise<DatabaseSMTPConfig[]>
  
  // ุชุญููู ุฅุนุฏุงุฏุงุช SMTP ุฅูู ุชูุณูู ูุงุจู ููุงุณุชุฎุฏุงู
  static formatSMTPConfig(settings: DatabaseSMTPConfig): any
  
  // ุงุฎุชุจุงุฑ ุฅุนุฏุงุฏุงุช SMTP
  static async testSMTPSettings(settings: DatabaseSMTPConfig): Promise<{ success: boolean; error?: string }>
}
```

### 2. ุชุญุฏูุซ UnifiedEmailService

ุชู ุชุนุฏูู `src/lib/unifiedEmailService.ts` ูุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:

#### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:

1. **ุฅุฒุงูุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุซุงุจุชุฉ**:
   ```typescript
   // ูุจู ุงูุชุนุฏูู
   private static readonly fromEmail = 'manage@kareemamged.com';
   private static readonly fromName = 'ุฑุฒูู - ููุตุฉ ุงูุฒูุงุฌ ุงูุฅุณูุงูู ุงูุดุฑุนู';
   
   // ุจุนุฏ ุงูุชุนุฏูู
   // ุฅุฒุงูุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุซุงุจุชุฉ - ุณูุชู ุฌูุจูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   ```

2. **ุชุญุฏูุซ ุฏุงูุฉ getSenderName**:
   ```typescript
   private static async getSenderName(language: 'ar' | 'en' = 'ar'): Promise<string> {
     const { DatabaseSMTPManager } = await import('./databaseSMTPManager');
     const settings = await DatabaseSMTPManager.getDefaultSMTPSettings();
     
     if (settings) {
       return language === 'ar' ? settings.from_name_ar : settings.from_name_en;
     }
     
     // ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุฅุนุฏุงุฏุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
     return language === 'ar' ? 'ุฑุฒูู - ููุตุฉ ุงูุฒูุงุฌ ุงูุฅุณูุงูู ุงูุดุฑุนู' : 'Rezge - Islamic Marriage Platform';
   }
   ```

3. **ุชุญุฏูุซ ุฏุงูุฉ sendEmail**:
   ```typescript
   // ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   const { DatabaseSMTPManager } = await import('./databaseSMTPManager');
   const smtpSettings = await DatabaseSMTPManager.getDefaultSMTPSettings();
   
   if (smtpSettings) {
     console.log('โ ุชู ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:', smtpSettings.smtp_host);
     const senderName = await this.getSenderName(language);
     enhancedEmailData = {
       ...emailData,
       from: emailData.from || smtpSettings.from_email,
       fromName: emailData.fromName || senderName,
       replyTo: emailData.replyTo || smtpSettings.reply_to || smtpSettings.from_email
     };
   }
   ```

4. **ุชุญุฏูุซ ุฏุงูุฉ sendViaSupabaseCustomSMTP**:
   ```typescript
   // ุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช SMTP ุงูุงูุชุฑุงุถูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   const { DatabaseSMTPManager } = await import('./databaseSMTPManager');
   const defaultSettings = await DatabaseSMTPManager.getDefaultSMTPSettings();
   
   if (defaultSettings) {
     requestBody.smtpConfig = DatabaseSMTPManager.formatSMTPConfig(defaultSettings);
   }
   ```

### 3. ุชุญุฏูุซ notificationEmailService

ุชู ุงูุชุฃูุฏ ูู ุฃู `notificationEmailService.ts` ููุฑุฑ `templateId` ุฅูู `UnifiedEmailService`:

```typescript
const emailResult = await UnifiedEmailService.sendEmail({
  to: userEmail,
  subject: processedSubject,
  html: processedHtml,
  text: processedText,
  from: smtpSettings.from_email,
  fromName: smtpSettings.from_name_ar,
  templateId: template.id  // โ ุชู ุชูุฑูุฑ ูุนุฑู ุงููุงูุจ
});
```

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ูุธุงู ุงููุงุด
- ุชุฎุฒูู ุฅุนุฏุงุฏุงุช SMTP ูู ุงููุงุด ููุฏุฉ 5 ุฏูุงุฆู
- ุชุญุณูู ุงูุฃุฏุงุก ูุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅููุงููุฉ ูุณุญ ุงููุงุด ุนูุฏ ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช

### 2. ุฏุนู ุฅุนุฏุงุฏุงุช ูุชุนุฏุฏุฉ
- ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุฃููุงู
- ุงูุนูุฏุฉ ููุฅุนุฏุงุฏุงุช ุงูุงุญุชูุงุทูุฉ ุฅุฐุง ูู ุชูู ููุงู ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ
- ุฏุนู ุฅุนุฏุงุฏุงุช SMTP ูุญุฏุฏุฉ ููู ูุงูุจ

### 3. ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช
- ุฅููุงููุฉ ุงุฎุชุจุงุฑ ุฅุนุฏุงุฏุงุช SMTP ูุจู ุงูุงุณุชุฎุฏุงู
- ุฅุฑุณุงู ุฅูููู ุงุฎุชุจุงุฑ ููุชุฃูุฏ ูู ุตุญุฉ ุงูุฅุนุฏุงุฏุงุช

### 4. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ูุดู ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุณุฌูู ููุตู ููุฃุฎุทุงุก

## ๐ ููููุฉ ุนูู ุงููุธุงู ุงูุฌุฏูุฏ

### 1. ุนูุฏ ุฅุฑุณุงู ุฅูููู ุนุงุฏู:
```
1. ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ุงูุงูุชุฑุงุถูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุฅุฐุง ูุงูุช ูุชุงุญุฉุ ุงุณุชุฎุฏุงููุง
3. ุฅุฐุง ูู ุชูู ูุชุงุญุฉุ ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุงููุฏููุฉ
4. ุฅุฑุณุงู ุงูุฅูููู ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุฏุฉ
```

### 2. ุนูุฏ ุฅุฑุณุงู ุฅูููู ุจุงุณุชุฎุฏุงู ูุงูุจ:
```
1. ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ุงููุญุฏุฏุฉ ูู ุงููุงูุจ
2. ุฅุฐุง ูุงูุช ูุชุงุญุฉุ ุงุณุชุฎุฏุงููุง
3. ุฅุฐุง ูู ุชูู ูุชุงุญุฉุ ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ
4. ุฅุฑุณุงู ุงูุฅูููู ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุฏุฉ
```

## ๐งช ุงูุงุฎุชุจุงุฑ

ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ ุดุงูู: `test-database-smtp-integration.html`

### ุงูููุฒุงุช ุงููุชุงุญุฉ ููุงุฎุชุจุงุฑ:
- โ ุงุฎุชุจุงุฑ ุฌูุจ ุฅุนุฏุงุฏุงุช SMTP ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฅูููู ุจุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุฎุชุจุงุฑ ูุงูุจ ุชุณุฌูู ุงูุฏุฎูู ุงููุงุฌุญ
- โ ูุญุต ุญุงูุฉ ุงููุธุงู

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
- `src/lib/databaseSMTPManager.ts` - ุฎุฏูุฉ ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช SMTP
- `test-database-smtp-integration.html` - ุตูุญุฉ ุงุฎุชุจุงุฑ ุดุงููุฉ
- `DATABASE_SMTP_INTEGRATION_SOLUTION.md` - ูุฐุง ุงูููู

### ูููุงุช ูุญุฏุซุฉ:
- `src/lib/unifiedEmailService.ts` - ุชุญุฏูุซ ูุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `src/lib/notificationEmailService.ts` - ุงูุชุฃูุฏ ูู ุชูุฑูุฑ templateId

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุฅุฐุง ูู ูุชู ุจุนุฏ):
```sql
-- ุชุดุบูู ุงูุณูุฑูุจุช ุงูููุฌูุฏ ูู update_email_tables_complete.sql
-- ูุฐุง ุณูุถูู ุงูุญููู ุงููุทููุจุฉ ููููุงูุจ ูุฅุนุฏุงุฏุงุช SMTP
```

### 2. ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช SMTP ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ:
- ุงูุฐูุงุจ ุฅูู "ุฅุฏุงุฑุฉ ูุธุงู ุงูุงุดุนุงุฑุงุช ุงูุจุฑูุฏูุฉ"
- ูุณู "ุฅุนุฏุงุฏุงุช SMTP"
- ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช SMTP ุฌุฏูุฏุฉ
- ุชุญุฏูุฏ ุงูุฅุนุฏุงุฏ ุงูุงูุชุฑุงุถู

### 3. ุฑุจุท ุงูููุงูุจ ุจุฅุนุฏุงุฏุงุช SMTP:
- ุงูุฐูุงุจ ุฅูู ูุณู "ููุงูุจ ุงูุงุดุนุงุฑุงุช"
- ุชุนุฏูู ุงูููุงูุจ ุงููุทููุจุฉ
- ุชุญุฏูุฏ ุฅุนุฏุงุฏุงุช SMTP ููู ูุงูุจ

### 4. ุงุฎุชุจุงุฑ ุงููุธุงู:
- ุงุณุชุฎุฏุงู ุตูุญุฉ ุงูุงุฎุชุจุงุฑ ุงููุฑููุฉ
- ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฅููููุงุช ูุฎุชููุฉ
- ุงูุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุตุญูุญุฉ

## โ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐุง ุงูุญู:

1. **ุงูููุงูุจ ุณุชุณุชุฎุฏู ุฅุนุฏุงุฏุงุช SMTP ุงููุญุฏุฏุฉ ููุง**
2. **ุงูุฅููููุงุช ุณุชูุฑุณู ุจุงูุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
3. **ุงููุธุงู ุณูุฏุนู ุฅุนุฏุงุฏุงุช SMTP ูุชุนุฏุฏุฉ**
4. **ุงูุฃุฏุงุก ุณูุชุญุณู ุจูุถู ูุธุงู ุงููุงุด**
5. **ุณูููุฉ ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช SMTP ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ**

## ๐จ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู**: ุงููุธุงู ุงูุฌุฏูุฏ ูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู ููู ููุณุฑ ุงููุธุงุฆู ุงูููุฌูุฏุฉ
2. **ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ**: ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุฅุนุฏุงุฏุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงููุฏููุฉ
3. **ุงูุฃุฏุงุก**: ูุธุงู ุงููุงุด ูุญุณู ุงูุฃุฏุงุก ูููู ูุฏ ูุญุชุงุฌ ุฅูู ูุณุญ ุงููุงุด ุนูุฏ ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
4. **ุงูุงุฎุชุจุงุฑ**: ูููุตุญ ุจุงุฎุชุจุงุฑ ุงููุธุงู ูู ุจูุฆุฉ ุงูุชุทููุฑ ูุจู ุงููุดุฑ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู ูุฌูุฏ ุฅุนุฏุงุฏุงุช SMTP ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุฃูุฏ ูู ุฃู ุงูุฅุนุฏุงุฏุงุช ูุดุทุฉ
3. ุงุณุชุฎุฏู ุตูุญุฉ ุงูุงุฎุชุจุงุฑ ุงููุฑููุฉ
4. ุฑุงุฌุน ุณุฌูุงุช ุงููููุณูู ููุฃุฎุทุงุก

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-01-22  
**ุงููุณุฎุฉ**: 1.0  
**ุงูุญุงูุฉ**: ุฌุงูุฒ ููุชุทุจูู โ




