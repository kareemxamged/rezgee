# تعليمات حذف الحساب "alrrakb@hotmail.com" وطلبات التحقق المعلقة

## 📋 نظرة عامة

هذا السكريبت يقوم بحذف الحساب المحدد نهائياً من قاعدة البيانات والمنصة، بالإضافة إلى حذف جميع طلبات التحقق المعلقة للحسابات الجديدة.

## 🎯 المهام المطلوبة

### 1. حذف الحساب "alrrakb@hotmail.com"
- ✅ البحث عن المستخدم في قاعدة البيانات
- ✅ حذف البيانات المرتبطة (كلمات المرور المؤقتة، طلبات التوثيق، إلخ)
- ✅ حذف المستخدم من جدول `users`
- ✅ حذف المستخدم من جدول `auth.users`

### 2. حذف طلبات التحقق المعلقة للحسابات الجديدة
- ✅ حذف طلبات التحقق من البريد الإلكتروني المعلقة
- ✅ حذف طلبات التوثيق المعلقة
- ✅ حذف كلمات المرور المؤقتة غير المستخدمة
- ✅ حذف طلبات إعادة تعيين كلمة المرور المعلقة

## 🚀 خطوات التشغيل

### الخطوة 1: إعداد متغيرات البيئة

تأكد من وجود متغيرات البيئة التالية:

```bash
# في ملف .env أو متغيرات البيئة
VITE_SUPABASE_URL=https://sbtzngewizgeqzfbhfjy.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

### الخطوة 2: تثبيت التبعيات

```bash
# نسخ ملف package.json
cp package-delete-script.json package.json

# تثبيت التبعيات
npm install
```

### الخطوة 3: تشغيل السكريبت

```bash
# تشغيل السكريبت
npm run delete-user

# أو مباشرة
node delete-user-account-script.js
```

## 📊 الجداول المتأثرة

### جداول المستخدم الرئيسية:
- `users` - جدول المستخدمين الرئيسي
- `auth.users` - جدول مصادقة Supabase

### جداول البيانات المرتبطة:
- `temporary_passwords` - كلمات المرور المؤقتة
- `password_reset_requests` - طلبات إعادة تعيين كلمة المرور
- `verification_requests` - طلبات التوثيق
- `user_trusted_devices` - الأجهزة الموثقة
- `user_verification_codes` - أكواد التحقق

### جداول طلبات التحقق المعلقة:
- `email_verifications` - طلبات التحقق من البريد الإلكتروني
- `verification_requests` - طلبات التوثيق المعلقة
- `temporary_passwords` - كلمات المرور المؤقتة غير المستخدمة
- `password_reset_requests` - طلبات إعادة تعيين كلمة المرور المعلقة

## ⚠️ تحذيرات مهمة

1. **لا يمكن التراجع**: عملية الحذف نهائية ولا يمكن استرداد البيانات
2. **النسخ الاحتياطي**: تأكد من وجود نسخة احتياطية قبل التشغيل
3. **صلاحيات الإدارة**: يتطلب Service Role Key للوصول الكامل
4. **الاختبار**: اختبر السكريبت في بيئة التطوير أولاً

## 🔍 التحقق من النتائج

بعد تشغيل السكريبت، يمكن التحقق من:

1. **عدم وجود المستخدم في قاعدة البيانات**:
```sql
SELECT * FROM users WHERE email = 'alrrakb@hotmail.com';
```

2. **عدم وجود طلبات تحقق معلقة**:
```sql
SELECT COUNT(*) FROM email_verifications WHERE status = 'pending';
SELECT COUNT(*) FROM verification_requests WHERE status IN ('pending', 'under_review');
```

3. **إمكانية إنشاء حساب جديد**:
- محاولة التسجيل بنفس البريد الإلكتروني
- التأكد من عدم وجود رسائل خطأ

## 📝 سجل التغييرات

### تاريخ الإنشاء: 09-08-2025
- ✅ إنشاء سكريبت حذف الحساب المحدد
- ✅ إضافة حذف طلبات التحقق المعلقة
- ✅ توثيق شامل للعملية
- ✅ إضافة تحذيرات أمان

## 🆘 استكشاف الأخطاء

### خطأ: "SUPABASE_SERVICE_ROLE_KEY غير محدد"
```bash
# الحل: إضافة متغير البيئة
export SUPABASE_SERVICE_ROLE_KEY="your_key_here"
```

### خطأ: "User not found"
```bash
# الحل: التحقق من صحة البريد الإلكتروني
# أو تشغيل السكريبت لحذف طلبات التحقق فقط
```

### خطأ: "Permission denied"
```bash
# الحل: التأكد من استخدام Service Role Key وليس Anon Key
```

## 📞 الدعم

في حالة مواجهة مشاكل، راجع:
1. ملفات README الموجودة في المشروع
2. سجلات الأخطاء في وحدة التحكم
3. توثيق Supabase الرسمي


