# ุฅุตูุงุญ ูุดููุฉ ุชุนุฏูู ุงูููุงูุจ

## ๐ **ุงููุดููุฉ:**

ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุชุนุฏูู ุงููุงูุจุ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุชุธูุฑ ูุงุฑุบุฉ ููุง ูุชู ุชุญููู ุจูุงูุงุช ุงููุงูุจ ูู ุงูุญููู.

## ๐ **ุงูุณุจุจ:**

### **1. ุนุฏู ุชุญููู ุงูุจูุงูุงุช:**
- ุฏุงูุฉ `handleUpdateTemplate` ูุง ุชุญูู ุจูุงูุงุช ุงููุงูุจ ูู `templateFormData`
- ุงููุงูุฐุฉ ุชุณุชุฎุฏู `templateFormData` ุงููุงุฑุบ ุจุฏูุงู ูู ุจูุงูุงุช ุงููุงูุจ ุงููุญุฏุฏ

### **2. ุนุฏู ุฑุจุท ุงูุจูุงูุงุช:**
- ุงูุญููู ูุฑุชุจุทุฉ ุจู `templateFormData` ูููุณ ุจู `editingTemplate`
- ูุง ูุชู ุชุญุฏูุซ `templateFormData` ุนูุฏ ูุชุญ ูุงูุฐุฉ ุงูุชุนุฏูู

## โ **ุงูุญู ุงูููุทุจู:**

### **1. ุชุญุฏูุซ ุฏุงูุฉ `handleUpdateTemplate`:**

#### **ูุจู ุงูุฅุตูุงุญ:**
```typescript
const handleUpdateTemplate = (template: EmailTemplate) => {
  setEditingTemplate(template);
  setShowTemplateModal(true);
};
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```typescript
const handleUpdateTemplate = (template: EmailTemplate) => {
  setEditingTemplate(template);
  setTemplateFormData({
    name: template.name || '',
    name_ar: template.name_ar || '',
    name_en: template.name_en || '',
    subject_ar: template.subject_ar || '',
    subject_en: template.subject_en || '',
    content_ar: template.content_ar || '',
    content_en: template.content_en || '',
    html_template_ar: template.html_template_ar || '',
    html_template_en: template.html_template_en || '',
    is_active: template.is_active || false
  });
  setShowTemplateModal(true);
};
```

### **2. ุชุญุฏูุซ ุฏุงูุฉ `handleSaveTemplate`:**

#### **ุฏุนู ุงูุชุนุฏูู ูุงูุฅูุดุงุก:**
```typescript
const handleSaveTemplate = async () => {
  if (!isTemplateFormValid) {
    showError('ุจูุงูุงุช ุบูุฑ ููุชููุฉ', 'ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ');
    return;
  }

  try {
    setLoading(true);
    
    const templateData = {
      ...templateFormData,
      updated_at: new Date().toISOString()
    };

    let result;
    if (editingTemplate) {
      // ุชุญุฏูุซ ูุงูุจ ููุฌูุฏ
      result = await EmailNotificationsAdminService.updateEmailTemplate(editingTemplate.id, templateData);
    } else {
      // ุฅูุดุงุก ูุงูุจ ุฌุฏูุฏ
      templateData.created_at = new Date().toISOString();
      result = await EmailNotificationsAdminService.createEmailTemplate(templateData);
    }
    
    if (result && result.success) {
      const action = editingTemplate ? 'ุชุญุฏูุซ' : 'ุฅูุดุงุก';
      showSuccess(
        `ุชู ${action} ุงููุงูุจ ุจูุฌุงุญ`,
        `ุชู ${action} ุงููุงูุจ "${templateFormData.name_ar}" ุจูุฌุงุญ ูู ุงููุธุงู`
      );
      setShowTemplateModal(false);
      setEditingTemplate(null);
      await refreshData();
    } else {
      showError(
        'ูุดู ูู ุญูุธ ุงููุงูุจ',
        `ุญุฏุซ ุฎุทุฃ ูู ุญูุธ ุงููุงูุจ: ${result?.error || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'}`
      );
    }
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุญูุธ ุงููุงูุจ:', error);
    showError(
      'ุฎุทุฃ ูู ุญูุธ ุงููุงูุจ',
      'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ูู ุญูุธ ุงููุงูุจ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.'
    );
  } finally {
    setLoading(false);
  }
};
```

### **3. ุฅุนุงุฏุฉ ุชุนููู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู:**

#### **ุฒุฑ ุงูุฅุบูุงู (X):**
```typescript
<button
  onClick={() => {
    setShowTemplateModal(false);
    setEditingTemplate(null);
    setTemplateFormData({
      name: '',
      name_ar: '',
      name_en: '',
      subject_ar: '',
      subject_en: '',
      content_ar: '',
      content_en: '',
      html_template_ar: '',
      html_template_en: '',
      is_active: true
    });
  }}
  className="modal-text-tertiary hover:modal-text-primary transition-colors"
>
  <X className="w-6 h-6" />
</button>
```

#### **ุฒุฑ ุงูุฅูุบุงุก:**
```typescript
<button
  onClick={() => {
    setShowTemplateModal(false);
    setEditingTemplate(null);
    setTemplateFormData({
      name: '',
      name_ar: '',
      name_en: '',
      subject_ar: '',
      subject_en: '',
      content_ar: '',
      content_en: '',
      html_template_ar: '',
      html_template_en: '',
      is_active: true
    });
  }}
  className="modal-button-secondary px-4 py-2 rounded-lg"
>
  ุฅูุบุงุก
</button>
```

## ๐ง **ุงูุชุญุณููุงุช ุงูุชูููุฉ:**

### **1. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ:**
- โ ุชุญููู ุจูุงูุงุช ุงููุงูุจ ูู `templateFormData` ุนูุฏ ุงูุชุนุฏูู
- โ ุฅุนุงุฏุฉ ุชุนููู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู
- โ ุชูุธูู ุงูุญุงูุฉ ุจุนุฏ ุงูุญูุธ ุงููุงุฌุญ

### **2. ุฏุนู ุงูุนูููุงุช ุงููุฒุฏูุฌุฉ:**
- โ ุฏุนู ุฅูุดุงุก ูุงูุจ ุฌุฏูุฏ
- โ ุฏุนู ุชุนุฏูู ูุงูุจ ููุฌูุฏ
- โ ุฑุณุงุฆู ูุฎุชููุฉ ุญุณุจ ููุน ุงูุนูููุฉ

### **3. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:**
- โ ุชุญููู ููุฑู ููุจูุงูุงุช ุนูุฏ ุงูุชุนุฏูู
- โ ุชูุธูู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู
- โ ุฑุณุงุฆู ูุงุถุญุฉ ูููุฌุงุญ ูุงููุดู

## ๐ **ุงููููุงุช ุงูููุญุฏุซุฉ:**

### **`src/components/admin/EmailNotificationsManagement.tsx`:**
- โ ุชุญุฏูุซ `handleUpdateTemplate` ูุชุญููู ุงูุจูุงูุงุช
- โ ุชุญุฏูุซ `handleSaveTemplate` ูุฏุนู ุงูุชุนุฏูู ูุงูุฅูุดุงุก
- โ ุฅุถุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู
- โ ุชุญุณูู ุฑุณุงุฆู ุงููุฌุงุญ ูุงููุดู

## ๐ **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**

### **1. ุชุนุฏูู ุงูููุงูุจ:**
- โ ุชุญููู ููุฑู ูุจูุงูุงุช ุงููุงูุจ ูู ุงูุญููู
- โ ุฅููุงููุฉ ุชุนุฏูู ุงูุจูุงูุงุช
- โ ุญูุธ ุงูุชุนุฏููุงุช ุจูุฌุงุญ
- โ ุชุญุฏูุซ ุงููุงุฆูุฉ ุจุนุฏ ุงูุชุนุฏูู

### **2. ุฅูุดุงุก ุงูููุงูุจ:**
- โ ูุชุญ ูุงูุฐุฉ ูุงุฑุบุฉ ููููุงูุจ ุงูุฌุฏูุฏุฉ
- โ ุฅููุงููุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
- โ ุญูุธ ุงููุงูุจ ุงูุฌุฏูุฏ ุจูุฌุงุญ
- โ ุธููุฑ ุงููุงูุจ ุงูุฌุฏูุฏ ูู ุงููุงุฆูุฉ

### **3. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ:**
- โ ุชูุธูู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู
- โ ุนุฏู ุชุฏุงุฎู ุงูุจูุงูุงุช ุจูู ุงูุนูููุงุช
- โ ุญุงูุฉ ูุงุถุญุฉ ููู ุนูููุฉ

## ๐งช **ุงุฎุชุจุงุฑ ุงููุธุงู:**

### **1. ุงุฎุชุจุงุฑ ุงูุชุนุฏูู:**
1. โ ุงูุถุบุท ุนูู ุฒุฑ ุชุนุฏูู ุฃู ูุงูุจ
2. โ ุงูุชุญูู ูู ุชุญููู ุงูุจูุงูุงุช ูู ุงูุญููู
3. โ ุชุนุฏูู ุจุนุถ ุงูุจูุงูุงุช
4. โ ุงูุถุบุท ุนูู ุญูุธ ูุงูุชุญูู ูู ุงููุฌุงุญ
5. โ ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงููุงุฆูุฉ

### **2. ุงุฎุชุจุงุฑ ุงูุฅูุดุงุก:**
1. โ ุงูุถุบุท ุนูู "ุฅุถุงูุฉ ูุงูุจ ุฌุฏูุฏ"
2. โ ุงูุชุญูู ูู ูุชุญ ูุงูุฐุฉ ูุงุฑุบุฉ
3. โ ููุก ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
4. โ ุงูุถุบุท ุนูู ุญูุธ ูุงูุชุญูู ูู ุงููุฌุงุญ
5. โ ุงูุชุญูู ูู ุธููุฑ ุงููุงูุจ ุงูุฌุฏูุฏ ูู ุงููุงุฆูุฉ

### **3. ุงุฎุชุจุงุฑ ุงูุฅุบูุงู:**
1. โ ูุชุญ ูุงูุฐุฉ ุชุนุฏูู ุฃู ุฅูุดุงุก
2. โ ุงูุถุบุท ุนูู ุฒุฑ ุงูุฅุบูุงู (X)
3. โ ุงูุชุญูู ูู ุชูุธูู ุงูุจูุงูุงุช
4. โ ูุชุญ ูุงูุฐุฉ ุฌุฏูุฏุฉ ูุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุจูุงูุงุช ูุฏููุฉ

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูุจูุงูุงุช ุงููุทููุจุฉ:**
- ูุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุงูุญูุธ
- ุงูุญููู ุงููุทููุจุฉ ูุฌุจ ุฃู ุชููู ููููุกุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุนุฏู ุงูุชูุงู ุงูุจูุงูุงุช

### **2. ุงูุนูููุงุช ุงููุฎุชููุฉ:**
- **ุฅูุดุงุก:** ุฅุถุงูุฉ `created_at` ู `updated_at`
- **ุชุนุฏูู:** ุฅุถุงูุฉ `updated_at` ููุท
- **ุฑุณุงุฆู ูุฎุชููุฉ:** "ุฅูุดุงุก" ููุงุจู "ุชุญุฏูุซ"

### **3. ุชูุธูู ุงูุญุงูุฉ:**
- ุฅุนุงุฏุฉ ุชุนููู `editingTemplate` ุฅูู `null`
- ุฅุนุงุฏุฉ ุชุนููู `templateFormData` ุฅูู ุงูููู ุงูุงูุชุฑุงุถูุฉ
- ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ

## ๐ฏ **ุงูุฎูุงุตุฉ:**

ุชู ุฅุตูุงุญ ูุดููุฉ ุชุนุฏูู ุงูููุงูุจ ุจูุฌุงุญ:

1. **โ ุชุญููู ุงูุจูุงูุงุช:** ูุชู ุชุญููู ุจูุงูุงุช ุงููุงูุจ ูู ุงูุญููู ุนูุฏ ุงูุชุนุฏูู
2. **โ ุฏุนู ุงูุนูููุงุช ุงููุฒุฏูุฌุฉ:** ุฏุนู ุฅูุดุงุก ูุชุนุฏูู ุงูููุงูุจ
3. **โ ุฅุฏุงุฑุฉ ุงูุญุงูุฉ:** ุชูุธูู ุงูุจูุงูุงุช ุนูุฏ ุงูุฅุบูุงู ูุงูุญูุธ
4. **โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:** ุชุญููู ููุฑู ูุฑุณุงุฆู ูุงุถุญุฉ

ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ููู ูู ุฅูุดุงุก ูุชุนุฏูู ุงูููุงูุจ!







