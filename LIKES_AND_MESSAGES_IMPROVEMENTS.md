# ๐๐จ ุชุญุณููุงุช ูุธุงู ุงูุฅุนุฌุงุจุงุช ูุงูุฑุณุงุฆู

## ๐ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. **ุนุฏู ูุฌูุฏ ุฅุดุนุงุฑุงุช ุงูุฑุฏ ุนูู ุงูุฅุนุฌุงุจ**
- โ **ุงููุดููุฉ**: ูุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุนูุฏ ูุจูู ุฃู ุฑูุถ ุฅุนุฌุงุจู
- โ **ุงูุญู**: ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ูุชูุงูู ููุฑุฏ ุนูู ุงูุฅุนุฌุงุจุงุช

### 2. **ูุดููุฉ ุนูุงูุงุช ูุฑุงุกุฉ ุงูุฑุณุงุฆู**
- โ **ุงููุดููุฉ**: ุนูุงูุฉ ุงูุตุญ ูุง ุชุชุญูู ููุฒุฑูุงุก ุนูุฏ ูุฑุงุกุฉ ุงูุฑุณุงูุฉ
- โ **ุงูุญู**: ุฅุตูุงุญ ูุธุงู ุชุชุจุน ูุฑุงุกุฉ ุงูุฑุณุงุฆู ุจุงุณุชุฎุฏุงู `read_at`

## ๐๏ธ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. **ูุธุงู ุฅุดุนุงุฑุงุช ุงูุฑุฏ ุนูู ุงูุฅุนุฌุงุจ**

#### ุฅูุดุงุก Trigger ููุฑุฏ ุนูู ุงูุฅุนุฌุงุจ:
```sql
CREATE OR REPLACE FUNCTION notify_like_response()
RETURNS TRIGGER AS $$
BEGIN
    -- ุงูุชุญูู ูู ุฃู ุงูุญุงูุฉ ุชุบูุฑุช ูู pending ุฅูู accepted ุฃู rejected
    IF OLD.status = 'pending' AND NEW.status IN ('accepted', 'rejected') THEN
        -- ุฅูุดุงุก ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุงูุฐู ุฃุฑุณู ุงูุฅุนุฌุงุจ
        PERFORM create_notification(
            NEW.liker_id,  -- ุงููุณุชุฎุฏู ุงูุฐู ุฃุฑุณู ุงูุฅุนุฌุงุจ
            NEW.liked_user_id,  -- ุงููุณุชุฎุฏู ุงูุฐู ุฑุฏ ุนูู ุงูุฅุนุฌุงุจ
            CASE 
                WHEN NEW.status = 'accepted' THEN 'like_accepted'
                WHEN NEW.status = 'rejected' THEN 'like_rejected'
            END,
            -- ุงูุนููุงู ูุงูุฑุณุงูุฉ ูุงูุฅุฌุฑุงุก ุญุณุจ ููุน ุงูุฑุฏ
        );
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER trigger_notify_like_response
    AFTER UPDATE ON public.likes
    FOR EACH ROW
    EXECUTE FUNCTION notify_like_response();
```

#### ุชุญุฏูุซ ูููุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุญุฐู ุงูููุฏ ุงููุฏูู
ALTER TABLE notifications DROP CONSTRAINT IF EXISTS notifications_type_check;

-- ุฅุถุงูุฉ ููุฏ ุฌุฏูุฏ ูุดูู ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ
ALTER TABLE notifications ADD CONSTRAINT notifications_type_check 
CHECK (type IN ('profile_view', 'like', 'like_accepted', 'like_rejected', 'message', 'match', 'system'));
```

### 2. **ุฅุตูุงุญ ูุธุงู ูุฑุงุกุฉ ุงูุฑุณุงุฆู**

#### ุฅุถุงูุฉ ุฏุงูุฉ ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุกุฉ:
```typescript
// ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฑุณุงุฆู
async markMessagesAsRead(conversationId: string, userId: string) {
  try {
    const { error } = await supabase
      .from('messages')
      .update({ 
        read_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      })
      .eq('conversation_id', conversationId)
      .neq('sender_id', userId) // ููุท ุงูุฑุณุงุฆู ุงูุชู ูู ูุฑุณููุง ุงููุณุชุฎุฏู ุงูุญุงูู
      .is('read_at', null); // ููุท ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ

    return { success: true };
  } catch (err) {
    return { success: false, error: err };
  }
}
```

#### ุชุญุฏูุซ ุฏุงูุฉ ุฌูุจ ุงูุฑุณุงุฆู:
```typescript
// ุฅุถุงูุฉ read_at ุฅูู ุงูุงุณุชุนูุงู
const { data, error } = await supabase
  .from('messages')
  .select(`
    id,
    conversation_id,
    sender_id,
    content,
    moderation_status,
    read_at,  // ุฅุถุงูุฉ ูุฐุง ุงูุญูู
    created_at,
    sender:users(id, first_name, last_name)
  `)
```

#### ุชุญุฏูุซ ุนุฑุถ ุญุงูุฉ ุงูุฑุณุงูุฉ:
```typescript
// ุงุณุชุฎุฏุงู read_at ุจุฏูุงู ูู is_read
} else if (message.read_at) {
  // Double check mark for read messages
  return (
    <div title={t('messages.messageStatus.read')} className="flex items-center">
      <CheckCheck className="w-4 h-4 text-blue-500" />
    </div>
  );
}
```

### 3. **ุงูุชุฑุฌูุงุช ุงูุฌุฏูุฏุฉ**

#### ุงูุนุฑุจูุฉ:
```json
"likeAccepted": {
  "title": "ุชู ูุจูู ุงูุฅุนุฌุงุจ",
  "message": "ูุจู {{name}} ุฅุนุฌุงุจู ุจูููู ุงูุดุฎุตู",
  "actionText": "ุนุฑุถ ุงูููู ุงูุดุฎุตู"
},
"likeRejected": {
  "title": "ุชู ุฑูุถ ุงูุฅุนุฌุงุจ",
  "message": "ุฑูุถ {{name}} ุฅุนุฌุงุจู ุจูููู ุงูุดุฎุตู",
  "actionText": "ุนุฑุถ ุงูููู ุงูุดุฎุตู"
}
```

#### ุงูุฅูุฌููุฒูุฉ:
```json
"likeAccepted": {
  "title": "Like Accepted",
  "message": "{{name}} accepted your like",
  "actionText": "View Profile"
},
"likeRejected": {
  "title": "Like Rejected",
  "message": "{{name}} rejected your like",
  "actionText": "View Profile"
}
```

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

### โ **ูุธุงู ุงูุฅุนุฌุงุจุงุช ุงููุญุณู:**
1. **ุฅุดุนุงุฑ ููุฑู** ุนูุฏ ูุจูู ุงูุฅุนุฌุงุจ
2. **ุฅุดุนุงุฑ ููุฑู** ุนูุฏ ุฑูุถ ุงูุฅุนุฌุงุจ
3. **ุธููุฑ ูู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช** ูููุญุฉ ุงูุชุญูู
4. **ุชุฑุฌูุงุช ูุงููุฉ** ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
5. **ุฑูุงุจุท ูุจุงุดุฑุฉ** ููููู ุงูุดุฎุตู

### โ **ูุธุงู ุงูุฑุณุงุฆู ุงููุญุณู:**
1. **ุนูุงูุฉ ุตุญ ุฑูุงุฏูุฉ** ููุฑุณุงุฆู ุงููุฑุณูุฉ
2. **ุนูุงูุฉ ุตุญ ุฒุฑูุงุก ูุฒุฏูุฌุฉ** ููุฑุณุงุฆู ุงูููุฑูุกุฉ
3. **ุชุญุฏูุซ ุชููุงุฆู** ูุญุงูุฉ ุงููุฑุงุกุฉ ุนูุฏ ูุชุญ ุงููุญุงุฏุซุฉ
4. **ุชุชุจุน ุฏููู** ูููุช ูุฑุงุกุฉ ูู ุฑุณุงูุฉ
5. **ุฃุฏุงุก ูุญุณู** ูุน ุงุณุชุนูุงูุงุช ูุญุณูุฉ

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุนุฌุงุจุงุช:
1. **ุงููุณุชุฎุฏู A** ูุฑุณู ุฅุนุฌุงุจ ูููุณุชุฎุฏู B
2. **ุงููุณุชุฎุฏู B** ูุฏุฎู ุตูุญุฉ ุงูุฅุนุฌุงุจุงุช
3. **ุงููุณุชุฎุฏู B** ููุจู ุฃู ูุฑูุถ ุงูุฅุนุฌุงุจ
4. **ุงููุณุชุฎุฏู A** ูุณุชูู ุฅุดุนุงุฑ ููุฑู ุจุงูุฑุฏ

### ุงุฎุชุจุงุฑ ูุธุงู ุงูุฑุณุงุฆู:
1. **ุงููุณุชุฎุฏู A** ูุฑุณู ุฑุณุงูุฉ ูููุณุชุฎุฏู B
2. **ุงููุณุชุฎุฏู A** ูุฑู ุนูุงูุฉ ุตุญ ุฑูุงุฏูุฉ (ูุฑุณูุฉ)
3. **ุงููุณุชุฎุฏู B** ููุชุญ ุงููุญุงุฏุซุฉ ูููุฑุฃ ุงูุฑุณุงูุฉ
4. **ุงููุณุชุฎุฏู A** ูุฑู ุนูุงูุฉ ุตุญ ุฒุฑูุงุก ูุฒุฏูุฌุฉ (ููุฑูุกุฉ)

## ๐ ุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ูุชูุงูู ููุฅุนุฌุงุจุงุช ูุงูุฑุณุงุฆู ูููุฑ:
- **ุชูุงุนู ููุฑู** ูุน ุฅุดุนุงุฑุงุช ูุญุธูุฉ
- **ุชุชุจุน ุฏููู** ูุญุงูุฉ ุงูุฑุณุงุฆู
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ูุน ุนูุงูุงุช ุจุตุฑูุฉ ูุงุถุญุฉ
- **ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู** ูุบุทู ุฌููุน ุงูุชูุงุนูุงุช
- **ุฃุฏุงุก ุนุงูู** ูุน ุงุณุชุนูุงูุงุช ูุญุณูุฉ
