# ุดุฑุญ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุจุฑูุฏูุฉ
## Notification Email System Explanation

**ุฑุฒูู - ููุตุฉ ุงูุฒูุงุฌ ุงูุฅุณูุงูู ุงูุดุฑุนู**  
**Rezge - Islamic Marriage Platform**

---

## ๐ฏ ููู ูุนูู ุงููุธุงูุ
## How Does the System Work?

### ๐ **ุงููุจุฏุฃ ุงูุฃุณุงุณู:**
### ๐ **Basic Principle:**

ุงููุธุงู ูุฑุงูุจ **ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ** (ุขุฎุฑ 24 ุณุงุนุฉ) ููุฑุณู ุฅููููุงุช ููุงุ **ุจุบุถ ุงููุธุฑ ุนู ููููุง ููุฑูุกุฉ ุฃู ูุง**.

The system monitors **all new notifications** (last 24 hours) and sends emails for them, **regardless of whether they are read or not**.

---

## ๐ ุขููุฉ ุงูุนูู:
## Working Mechanism:

### 1. **ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ:**
### 1. **Continuous Monitoring:**

```typescript
// ุงููุธุงู ููุญุต ูู 15 ุซุงููุฉ
setInterval(async () => {
  await this.processUnreadNotifications();
}, 15000);
```

### 2. **ุฌูุจ ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ:**
### 2. **Fetch New Notifications:**

```typescript
const { data: notifications } = await supabase
  .from('notifications')
  .select(`...`)
  .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()) // ุขุฎุฑ 24 ุณุงุนุฉ
  .limit(this.config.batchSize)
  .order('created_at', { ascending: true });
```

**ุงูููู:** ุงููุธุงู ูุง ููุชู ุจุญุงูุฉ `is_read` - ููุญุต ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ!  
**Important:** The system doesn't care about `is_read` status - it checks all new notifications!

### 3. **ููุน ุงูุฅุฑุณุงู ุงูููุฑุฑ:**
### 3. **Prevent Duplicate Sending:**

```typescript
// ุงูุชุญูู ูู ุนุฏู ุฅุฑุณุงู ุฅูููู ููุฐุง ุงูุฅุดุนุงุฑ ูู ูุจู
const emailStatus = await this.getEmailStatus(notification.id);
if (emailStatus && emailStatus.email_status === 'sent') {
  this.log('debug', `โญ๏ธ ุชู ุชุฎุทู ุงูุฅุดุนุงุฑ ${notification.id} - ุชู ุฅุฑุณุงู ุฅูููู ูู ูุจู`);
  continue;
}
```

---

## ๐ ุฃูุซูุฉ ุนูููุฉ:
## Practical Examples:

### **ูุซุงู 1: ุงูุฅุนุฌุงุจ**
### **Example 1: Like**

1. **ุงููุณุชุฎุฏู (ุฃ) ูุนุฌุจ ุจุงููุณุชุฎุฏู (ุจ)**
2. **ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
3. **ุงููุธุงู ููุชุดู ุงูุฅุดุนุงุฑ ุงูุฌุฏูุฏ ุฎูุงู 15 ุซุงููุฉ**
4. **ูุฑุณู ุฅูููู ูููุณุชุฎุฏู (ุจ) ููุฑุงู**
5. **ูุณุฌู ูู ุฌุฏูู ุงูุชุชุจุน ุฃู ุงูุฅูููู ุชู ุฅุฑุณุงูู**

### **ูุซุงู 2: ูุดุงูุฏุฉ ุงูููู ุงูุดุฎุตู**
### **Example 2: Profile View**

1. **ุงููุณุชุฎุฏู (ุฃ) ูุดุงูุฏ ููู ุงููุณุชุฎุฏู (ุจ)**
2. **ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
3. **ุงููุธุงู ููุชุดู ุงูุฅุดุนุงุฑ ุงูุฌุฏูุฏ ุฎูุงู 15 ุซุงููุฉ**
4. **ูุฑุณู ุฅูููู ูููุณุชุฎุฏู (ุจ) ููุฑุงู**
5. **ูุณุฌู ูู ุฌุฏูู ุงูุชุชุจุน ุฃู ุงูุฅูููู ุชู ุฅุฑุณุงูู**

---

## โก ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:
## โก Key Features:

### โ **ุนูู ูุณุชูู:**
- ูุนูู ุจุฏูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏููู
- ูุนูู 24/7 ูู ุงูุฎูููุฉ
- ูุง ูุญุชุงุฌ ุชุฏุฎู ุงููุณุชุฎุฏู

### โ **ูุฑุงูุจุฉ ุฐููุฉ:**
- ููุญุต ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ ููุท (ุขุฎุฑ 24 ุณุงุนุฉ)
- ูุง ููุชู ุจุญุงูุฉ ุงููุฑุงุกุฉ (`is_read`)
- ูุชุฌูุจ ุงูุฅุฑุณุงู ุงูููุฑุฑ

### โ **ุฅุฑุณุงู ููุฑู:**
- ูุฑุณู ุงูุฅููููุงุช ุฎูุงู 15 ุซุงููุฉ ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑ
- ูุนูู ูุฌููุน ุฃููุงุน ุงูุฅุดุนุงุฑุงุช
- ูุถูู ูุตูู ุงูุฅููููุงุช ูููุณุชุฎุฏููู

---

## ๐ฏ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฏุนููุฉ:
## ๐ฏ Supported Notification Types:

| ุงูููุน | ุงููุตู | ูุซุงู |
|-------|--------|------|
| **like** | ุงูุฅุนุฌุงุจ | ุดุฎุต ุฃุนุฌุจ ุจุญุณุงุจู |
| **profile_view** | ูุดุงูุฏุฉ ุงูููู | ุดุฎุต ุดุงูุฏ ูููู ุงูุดุฎุตู |
| **message** | ุฑุณุงูุฉ ุฌุฏูุฏุฉ | ุดุฎุต ุฃุฑุณู ูู ุฑุณุงูุฉ |
| **match** | ูุทุงุจูุฉ ุฌุฏูุฏุฉ | ุญุฏุซุช ูุทุงุจูุฉ ุฌุฏูุฏุฉ |
| **report_received** | ุงุณุชูุงู ุจูุงุบ | ุชู ุงูุฅุจูุงุบ ุนูู |
| **report_accepted** | ูุจูู ุจูุงุบ | ุชู ูุจูู ุงูุจูุงุบ ุถุฏู |
| **report_rejected** | ุฑูุถ ุจูุงุบ | ุชู ุฑูุถ ุงูุจูุงุบ ุถุฏู |
| **verification_approved** | ูุจูู ุชูุซูู | ุชู ูุจูู ุทูุจ ุงูุชูุซูู |
| **verification_rejected** | ุฑูุถ ุชูุซูู | ุชู ุฑูุถ ุทูุจ ุงูุชูุซูู |
| **system** | ุฅุดุนุงุฑ ูุธุงู | ุฅุดุนุงุฑุงุช ุงููุธุงู ุงูุนุงูุฉ |

---

## ๐ ูุซุงู ูุงูู:
## ๐ Complete Example:

### **ุงูุณููุงุฑูู:**
ุงููุณุชุฎุฏู "ุฃุญูุฏ" ูุนุฌุจ ุจุงููุณุชุฎุฏูุฉ "ูุงุทูุฉ"

### **ูุง ูุญุฏุซ:**

1. **ุฅูุดุงุก ุงูุฅุดุนุงุฑ:**
```sql
INSERT INTO notifications (
  user_id, from_user_id, type, title, message, created_at
) VALUES (
  'fatemah_id', 'ahmed_id', 'like', 'ุฅุนุฌุงุจ ุฌุฏูุฏ', 'ุฃุญูุฏ ุฃุนุฌุจ ุจุญุณุงุจู', NOW()
);
```

2. **ุงูุชุดุงู ุงููุธุงู:**
```
๐ง ุชู ุงูุนุซูุฑ ุนูู 1 ุฅุดุนุงุฑ ุฌุฏูุฏ
```

3. **ุฅุฑุณุงู ุงูุฅูููู:**
```
โ ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุจุฑูุฏู: like ูููุณุชุฎุฏู fatemah_id
```

4. **ุชุณุฌูู ุงูุชุชุจุน:**
```sql
INSERT INTO notification_email_tracking (
  notification_id, email_status, email_sent_at
) VALUES (
  'notification_id', 'sent', NOW()
);
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช:
## ๐ Statistics:

ุงููุธุงู ูุญุชูุธ ุจุฅุญุตุงุฆูุงุช ููุตูุฉ:

- **ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุนุงูุฌุฉ**
- **ุนุฏุฏ ุงูุฅููููุงุช ุงููุฑุณูุฉ**
- **ุนุฏุฏ ุงูุฅููููุงุช ุงููุงุดูุฉ**
- **ูุนุฏู ุงููุฌุงุญ**
- **ููุช ุงูุชุดุบูู**

---

## ๐ ุงูุฎูุงุตุฉ:
## ๐ Summary:

**ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู!**

- โ ูุฑุงูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ
- โ ูุง ููุชู ุจุญุงูุฉ ุงููุฑุงุกุฉ
- โ ูุฑุณู ุงูุฅููููุงุช ููุฑุงู
- โ ูุชุฌูุจ ุงูุฅุฑุณุงู ุงูููุฑุฑ
- โ ูุนูู 24/7 ุจุฏูู ุชุฏุฎู

**The system works perfectly!**

- โ Monitors all new notifications
- โ Doesn't care about read status
- โ Sends emails immediately
- โ Prevents duplicate sending
- โ Works 24/7 without intervention

---

**ุชุงุฑูุฎ ุงูุชูุถูุญ:** 2025-01-09  
**Explanation Date:** 2025-01-09

**ูุฑูู ุงูุชุทููุฑ - ุฑุฒูู**  
**Development Team - Rezge**






