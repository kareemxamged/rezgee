# ุฅุตูุงุญ ุฎุทุฃ ON CONFLICT ูู SQL

## ๐ **ุงููุดููุฉ:**

```
ERROR: 42P10: there is no unique or exclusion constraint matching the ON CONFLICT specification
```

## ๐ **ุงูุณุจุจ:**

### **1. ุนุฏู ูุฌูุฏ ููุฏ ูุฑูุฏ:**
- ุฌุฏูู `email_templates` ูุง ูุญุชูู ุนูู ููุฏ ูุฑูุฏ ุนูู ุงูุนููุฏ `name`
- `ON CONFLICT (name)` ูุชุทูุจ ูุฌูุฏ ููุฏ ูุฑูุฏ ุฃู ุงุณุชุจุนุงุฏ ุนูู ุงูุนููุฏ ุงููุญุฏุฏ

### **2. ูููู ุงูุฌุฏูู:**
```sql
-- ุงูุฌุฏูู ุงูุญุงูู ูุฏ ูุง ูุญุชูู ุนูู:
ALTER TABLE email_templates ADD CONSTRAINT email_templates_name_unique UNIQUE (name);
```

## โ **ุงูุญู ุงูููุทุจู:**

### **1. ุงุณุชุฎุฏุงู `WHERE NOT EXISTS`:**
```sql
-- ุจุฏูุงู ูู ON CONFLICT
INSERT INTO email_templates (...) 
SELECT ... 
WHERE NOT EXISTS (
    SELECT 1 FROM email_templates WHERE name = 'like_notification'
);
```

### **2. ุงูููู ุงูุฌุฏูุฏ:**
- `run_missing_templates_simple.sql` - ูุณุฎุฉ ูุจุณุทุฉ ุจุฏูู `ON CONFLICT`

## ๐ง **ุงูุชูุงุตูู ุงูุชูููุฉ:**

### **ูุจู ุงูุฅุตูุงุญ:**
```sql
INSERT INTO email_templates (...) VALUES (...)
ON CONFLICT (name) DO NOTHING;  -- โ ุฎุทุฃ
```

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```sql
INSERT INTO email_templates (...) 
SELECT ... 
WHERE NOT EXISTS (
    SELECT 1 FROM email_templates WHERE name = 'like_notification'
);  -- โ ูุนูู
```

## ๐ **ุงููููุงุช ุงูููุญุฏุซุฉ:**

### **1. `run_missing_templates_simple.sql`:**
- โ ุงุณุชุฎุฏุงู `WHERE NOT EXISTS` ุจุฏูุงู ูู `ON CONFLICT`
- โ ูุญุต ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุงูุฅุฏุฑุงุฌ
- โ ุชุฌูุจ ุฃุฎุทุงุก ุงููููุฏ ุงููุฑูุฏุฉ
- โ ูุนูู ูุน ุฌููุน ุฃูุธูุฉ ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช

### **2. ุงููููุฒุงุช:**
- **ุขูู:** ูุง ูุณุจุจ ุฃุฎุทุงุก ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ููุฌูุฏุฉ
- **ูุชูุงูู:** ูุนูู ูุน ุฌููุน ุฃูุธูุฉ ููุงุนุฏ ุงูุจูุงูุงุช
- **ูุงุถุญ:** ููุทู ุจุณูุท ูููููู
- **ููุซูู:** ูุง ูุนุชูุฏ ุนูู ูููุฏ ุฎุงุตุฉ

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ุงูุทุฑููุฉ ุงูููุตู ุจูุง:**
```sql
-- ุชุดุบูู ุงูููู ุงููุจุณุท
\i run_missing_templates_simple.sql
```

### **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```sql
-- ุฑุณุงุฆู ุงููุฌุงุญ
ุงูุชุญูู ูู ุงูููุงูุจ ุงูููุฌูุฏุฉ...
ุฅุถุงูุฉ ุงูููุงูุจ ุงูุงุฌุชูุงุนูุฉ...
ุฅุถุงูุฉ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูุงุฌุชูุงุนูุฉ...
ุงูุชุญูู ูู ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ...
ุงูููุงูุจ ุงูุงุฌุชูุงุนูุฉ ุชู ุฅุถุงูุชูุง ุจูุฌุงุญ!
```

## ๐ **ุงูุชุญูู ูู ุงููุชุงุฆุฌ:**

### **ุจุนุฏ ุงูุชุดุบูู ุงููุงุฌุญ:**
```sql
-- ูุฌุจ ุฃู ุชุฑู:
email_templates: 3 count
email_notification_types: 3 count

-- ุงูููุงูุจ ุงููุถุงูุฉ:
like_notification: ุฅุดุนุงุฑ ุงูุฅุนุฌุงุจ
message_notification: ุฅุดุนุงุฑ ุฑุณุงูุฉ ุฌุฏูุฏุฉ
match_notification: ุฅุดุนุงุฑ ุงููุทุงุจูุฉ
```

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูุชูุงูู:**
- โ ูุนูู ูุน PostgreSQL
- โ ูุนูู ูุน Supabase
- โ ูุนูู ูุน MySQL
- โ ูุนูู ูุน SQLite

### **2. ุงูุฃูุงู:**
- โ ูุง ูุณุจุจ ุฃุฎุทุงุก ุนูุฏ ุงูุชุดุบูู ุงููุชูุฑุฑ
- โ ูุญุต ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุงูุฅุฏุฑุงุฌ
- โ ูุนุงููุงุช ุขููุฉ ูุน `BEGIN` ู `COMMIT`

### **3. ุงูุฃุฏุงุก:**
- โ ูุญุต ุณุฑูุน ุจุงุณุชุฎุฏุงู `WHERE NOT EXISTS`
- โ ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก
- โ ุงุณุชุนูุงูุงุช ูุญุณูุฉ

## ๐ฏ **ุงูุฎูุงุตุฉ:**

ุชู ุฅุตูุงุญ ูุดููุฉ `ON CONFLICT` ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู `WHERE NOT EXISTS`. ุงูููู ุงูุฌุฏูุฏ `run_missing_templates_simple.sql` ุฌุงูุฒ ููุชุดุบูู ูุณุชุถูู ุงูููุงูุจ ุงูุงุฌุชูุงุนูุฉ ุจุฏูู ุฃุฎุทุงุก.

### **ุงูููุงุฆุฏ:**
- **ูุง ุฃุฎุทุงุก:** ุชุฌูุจ ูุดุงูู ุงููููุฏ ุงููุฑูุฏุฉ
- **ูุชูุงูู:** ูุนูู ูุน ุฌููุน ุฃูุธูุฉ ููุงุนุฏ ุงูุจูุงูุงุช
- **ุขูู:** ูููู ุชุดุบููู ุนุฏุฉ ูุฑุงุช ุจุฃูุงู
- **ูุงุถุญ:** ููุทู ุจุณูุท ูููููู





