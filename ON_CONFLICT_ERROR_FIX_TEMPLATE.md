# ุฅุตูุงุญ ุฎุทุฃ ON CONFLICT ูู ูุงูุจ ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ

## ๐จ **ุงููุดููุฉ:**

```
ERROR: 42P10: there is no unique or exclusion constraint matching the ON CONFLICT specification
```

## ๐ **ุงูุณุจุจ:**

### **1. ุนุฏู ูุฌูุฏ ูููุฏ ูุฑูุฏุฉ:**
- ุงูุฌุฏุงูู `email_templates` ู `email_notification_types` ูุง ุชุญุชูู ุนูู ูููุฏ ูุฑูุฏุฉ (unique constraints) ุนูู ุงูุนููุฏ `name`
- `ON CONFLICT` ูุชุทูุจ ูุฌูุฏ ููุฏ ูุฑูุฏ ููุนูู ุจุดูู ุตุญูุญ

### **2. ุจููุฉ ุงูุฌุฏุงูู:**
- ุงูุฌุฏุงูู ุชุณุชุฎุฏู `id` ูู primary key ููุท
- ูุง ููุฌุฏ `UNIQUE` constraint ุนูู `name`

## โ **ุงูุญู ุงูููุทุจู:**

### **1. ุฅูุดุงุก ูุณุฎุฉ ูุจุณุทุฉ ุจุฏูู ON CONFLICT:**

#### **ูุจู ุงูุฅุตูุงุญ:**
```sql
INSERT INTO email_templates (...) 
VALUES (...) 
ON CONFLICT (name) DO UPDATE SET ...;
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```sql
INSERT INTO email_templates (...) 
VALUES (...);
```

### **2. ุงูููู ุงูุฌุฏูุฏ:**
- `add_temporary_password_template_simple.sql` - ูุณุฎุฉ ูุจุณุทุฉ ุจุฏูู `ON CONFLICT`

## ๐ง **ุงูุชูุงุตูู ุงูุชูููุฉ:**

### **1. ุฅุฒุงูุฉ ON CONFLICT:**
- ุฅุฒุงูุฉ `ON CONFLICT (name) DO UPDATE SET` ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช
- ุงุณุชุฎุฏุงู `INSERT` ูุจุงุดุฑ

### **2. ุงูุญูุงุธ ุนูู ุงููุธุงุฆู:**
- ููุณ ุงูุจูุงูุงุช ูุงููุญุชูู
- ููุณ ุงููููู ูุงูุชุตููู
- ููุณ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### **3. ุงูุชุนุงูู ูุน ุงูููุฑุฑุงุช:**
- ุฅุฐุง ูุงู ุงููุงูุจ ููุฌูุฏ ุจุงููุนูุ ุณูุธูุฑ ุฎุทุฃ duplicate
- ูููู ุญุฐู ุงููุงูุจ ุงูููุฌูุฏ ุฃููุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ

## ๐ **ุงููููุงุช ุงูููุญุฏุซุฉ:**

### **`add_temporary_password_template_simple.sql`:**
- โ ุฅุฒุงูุฉ ุฌููุน `ON CONFLICT` clauses
- โ ุงุณุชุฎุฏุงู `INSERT` ูุจุงุดุฑ
- โ ุงูุญูุงุธ ุนูู ููุณ ุงููุญุชูู ูุงูุจูุงูุงุช
- โ ุฅุถุงูุฉ ุนุฑุถ ุงููุชุงุฆุฌ ููุชุญูู

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ุงูุทุฑููุฉ 1: ุชุดุบูู ุงูููู ุงูุฌุฏูุฏ (ููุตู ุจู):**
```sql
\i add_temporary_password_template_simple.sql
```

### **ุงูุทุฑููุฉ 2: ุงูุชุญูู ูู ูุฌูุฏ ุงููุงูุจ ุฃููุงู:**
```sql
-- ุงูุชุญูู ูู ูุฌูุฏ ุงููุงูุจ
SELECT name FROM email_templates WHERE name = 'temporary_password';

-- ุฅุฐุง ูุงู ููุฌูุฏุ ุงุญุฐูู ุฃููุงู
DELETE FROM email_templates WHERE name = 'temporary_password';
DELETE FROM email_notification_types WHERE name = 'temporary_password';

-- ุซู ุดุบู ุงูููู ุงูุฌุฏูุฏ
\i add_temporary_password_template_simple.sql
```

## ๐ **ุงูุชุญูู ูู ุงููุชุงุฆุฌ:**

### **ุจุนุฏ ุชุดุบูู ุงูุงุณุชุนูุงู:**
```sql
-- ุงูุชุญูู ูู ุงููุงูุจ
SELECT 
    name,
    name_ar,
    name_en,
    subject_ar,
    subject_en,
    is_active,
    created_at
FROM email_templates 
WHERE name = 'temporary_password';

-- ุงูุชุญูู ูู ููุน ุงูุฅุดุนุงุฑ
SELECT 
    name,
    name_ar,
    name_en,
    description_ar,
    description_en,
    is_active,
    created_at
FROM email_notification_types 
WHERE name = 'temporary_password';
```

### **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- โ ูุงูุจ `temporary_password` ููุฌูุฏ ูู `email_templates`
- โ ููุน ุฅุดุนุงุฑ `temporary_password` ููุฌูุฏ ูู `email_notification_types`
- โ ุงููุณุฎุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ููุฌูุฏุชุงู
- โ HTML templates ูููุณุฎุชูู ููุฌูุฏุฉ
- โ Text content ูููุณุฎุชูู ููุฌูุฏ

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูุชุนุงูู ูุน ุงูููุฑุฑุงุช:**
- ุฅุฐุง ูุงู ุงููุงูุจ ููุฌูุฏ ุจุงููุนูุ ุณูุธูุฑ ุฎุทุฃ duplicate
- ูููู ุญุฐู ุงููุงูุจ ุงูููุฌูุฏ ุฃููุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ

### **2. ุงููุณุฎ ุงูุงุญุชูุงุทู:**
- ุชุฃูุฏ ูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ุงูุชุดุบูู
- ูููู ุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑ

### **3. ุงูุงุฎุชุจุงุฑ:**
- ุงุฎุชุจุฑ ุงููุธุงู ุจุนุฏ ุงูุชุดุบูู
- ุชุฃูุฏ ูู ุฃู ุงููุงูุจ ูุนูู ุจุดูู ุตุญูุญ

## ๐ฏ **ุงูุฎูุงุตุฉ:**

ุชู ุฅุตูุงุญ ุฎุทุฃ `ON CONFLICT` ุจูุฌุงุญ ูู ุฎูุงู:

1. **ุฅุฒุงูุฉ ON CONFLICT:** ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช
2. **ุงุณุชุฎุฏุงู INSERT ูุจุงุดุฑ:** ุจุฏูู ูุนุงูุฌุฉ ุงูุชุถุงุฑุจ
3. **ุงูุญูุงุธ ุนูู ุงููุญุชูู:** ููุณ ุงูุจูุงูุงุช ูุงูุชุตููู
4. **ุฅูุดุงุก ููู ุฌุฏูุฏ:** `add_temporary_password_template_simple.sql`

ุงูุขู ูููู ุชุดุบูู ุงูุงุณุชุนูุงู ุจุฏูู ุฃุฎุทุงุก!





