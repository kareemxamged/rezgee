# ุฎุทุฉ ููู ูุงูุจ ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ฏ **ุงููุฏู:**
ููู ูุงูุจ ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ูู ุงูููุฏ ุงููุฏูุฌ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุชู ุงูุชุญูู ููู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ.

## ๐ **ุงูุฎุทูุงุช:**

### **ุงููุฑุญูุฉ 1: ุฅุฏุฑุงุฌ ุงููุงูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

#### **1.1 ุชุดุบูู SQL Script:**
```sql
\i add_temporary_password_template.sql
```

#### **1.2 ุงูุชุญูู ูู ุงููุชุงุฆุฌ:**
- โ ุฅูุดุงุก ููุน ุฅุดุนุงุฑ `temporary_password`
- โ ุฅูุดุงุก ูุงูุจ `temporary_password` ูุน ุงููุณุฎุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ HTML templates ูููุณุฎุชูู
- โ Text content ูููุณุฎุชูู

### **ุงููุฑุญูุฉ 2: ุชุญุฏูุซ ุงููุธุงู ููุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

#### **2.1 ุชุญุฏูุซ `UnifiedEmailService.sendTemporaryPasswordEmail()`:**

**ูุจู ุงูุชุญุฏูุซ:**
```typescript
static async sendTemporaryPasswordEmail(
  email: string,
  temporaryPassword: string,
  expiresAt: string,
  recipientName?: string,
  language: 'ar' | 'en' = 'ar'
): Promise<EmailResult> {
  try {
    // ุงุณุชูุฑุงุฏ finalEmailService
    const { AdvancedEmailService } = await import('./finalEmailService');
    
    // ุงุณุชุฎุฏุงู ุชููุจููุช ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ูู finalEmailService
    const template = AdvancedEmailService.generateEmailTemplate('temporary_password', {
      temporaryPassword,
      expiresAt,
      recipientName
    }, language);

    return await this.sendEmail({
      to: email,
      subject: template.subject,
      html: template.htmlContent,
      text: template.textContent,
      type: 'temporary_password'
    }, 'security', language);
  } catch (error) {
    // ูุนุงูุฌุฉ ุงูุฎุทุฃ...
  }
}
```

**ุจุนุฏ ุงูุชุญุฏูุซ:**
```typescript
static async sendTemporaryPasswordEmail(
  email: string,
  temporaryPassword: string,
  expiresAt: string,
  recipientName?: string,
  language: 'ar' | 'en' = 'ar'
): Promise<EmailResult> {
  try {
    // ุงุณุชูุฑุงุฏ DatabaseEmailService
    const { DatabaseEmailService } = await import('./databaseEmailService');
    
    // ุฌูุจ ุงููุงูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    const template = await DatabaseEmailService.getEmailTemplate('temporary_password', language);
    
    if (!template) {
      throw new Error(`ูู ูุชู ุงูุนุซูุฑ ุนูู ูุงูุจ ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ: ${language}`);
    }

    // ุงุณุชุจุฏุงู ุงููุชุบูุฑุงุช ูู ุงููุญุชูู
    const processedContent = this.processTemplateVariables(template, {
      temporaryPassword,
      expiresAt,
      recipientName: recipientName || (language === 'ar' ? 'ุนุฒูุฒู ุงููุณุชุฎุฏู' : 'Dear User')
    });

    return await this.sendEmail({
      to: email,
      subject: processedContent.subject,
      html: processedContent.htmlContent,
      text: processedContent.textContent,
      type: 'temporary_password'
    }, 'security', language);
  } catch (error) {
    // ูุนุงูุฌุฉ ุงูุฎุทุฃ...
  }
}
```

#### **2.2 ุฅุถุงูุฉ ุฏุงูุฉ ูุนุงูุฌุฉ ุงููุชุบูุฑุงุช:**

```typescript
private static processTemplateVariables(template: any, variables: any): any {
  const processText = (text: string): string => {
    let processed = text;
    Object.keys(variables).forEach(key => {
      const placeholder = `{{${key}}}`;
      processed = processed.replace(new RegExp(placeholder, 'g'), variables[key] || '');
    });
    return processed;
  };

  return {
    subject: processText(template.subject_ar || template.subject_en),
    htmlContent: processText(template.html_template_ar || template.html_template_en),
    textContent: processText(template.content_ar || template.content_en)
  };
}
```

### **ุงููุฑุญูุฉ 3: ุงุฎุชุจุงุฑ ุงููุธุงู**

#### **3.1 ุงุฎุชุจุงุฑ ุงููุณุฎุฉ ุงูุนุฑุจูุฉ:**
1. โ ูุชุญ ุตูุญุฉ "ูุณูุช ูููุฉ ุงููุฑูุฑ"
2. โ ุฅุฏุฎุงู ุฅูููู ุตุญูุญ
3. โ ุงูุถุบุท ุนูู "ุฅุฑุณุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ"
4. โ ุงูุชุญูู ูู ูุตูู ุงูุฅูููู
5. โ ุงูุชุญูู ูู ุฃู ุงููุญุชูู ูุทุงุจู ูููุญุชูู ุงูุญุงูู

#### **3.2 ุงุฎุชุจุงุฑ ุงููุณุฎุฉ ุงูุฅูุฌููุฒูุฉ:**
1. โ ุชุบููุฑ ุงููุบุฉ ุฅูู ุงูุฅูุฌููุฒูุฉ
2. โ ูุชุญ ุตูุญุฉ "ูุณูุช ูููุฉ ุงููุฑูุฑ"
3. โ ุฅุฏุฎุงู ุฅูููู ุตุญูุญ
4. โ ุงูุถุบุท ุนูู "ุฅุฑุณุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ"
5. โ ุงูุชุญูู ูู ูุตูู ุงูุฅูููู ุจุงูุฅูุฌููุฒูุฉ
6. โ ุงูุชุญูู ูู ุฃู ุงููุญุชูู ูุทุงุจู ูููุญุชูู ุงูุญุงูู

#### **3.3 ุงุฎุชุจุงุฑ ููุญุฉ ุงูุฅุฏุงุฑุฉ:**
1. โ ูุชุญ ุตูุญุฉ "ุงูุฅุดุนุงุฑุงุช ุงูุจุฑูุฏูุฉ" ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
2. โ ุงูุชุญูู ูู ุธููุฑ ูุงูุจ `temporary_password` ูู ุงููุงุฆูุฉ
3. โ ุงุฎุชุจุงุฑ ุชุนุฏูู ุงููุงูุจ ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
4. โ ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฅูููู ุชุฌุฑูุจู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

### **ุงููุฑุญูุฉ 4: ุงูุชุญูู ูู ุงูุชูุงูู**

#### **4.1 ุงูุชุญูู ูู ุฃู ุงููุญุชูู ูุทุงุจู:**
- โ ุงููุณุฎุฉ ุงูุนุฑุจูุฉ ูุทุงุจูุฉ ูููุญุชูู ุงูุญุงูู
- โ ุงููุณุฎุฉ ุงูุฅูุฌููุฒูุฉ ูุทุงุจูุฉ ูููุญุชูู ุงูุญุงูู
- โ HTML template ูุนูู ุจุดูู ุตุญูุญ
- โ Text content ูุนูู ุจุดูู ุตุญูุญ

#### **4.2 ุงูุชุญูู ูู ุงููุชุบูุฑุงุช:**
- โ `{{temporaryPassword}}` ูุชู ุงุณุชุจุฏุงููุง ุจุดูู ุตุญูุญ
- โ `{{expiryTime}}` ูุชู ุงุณุชุจุฏุงููุง ุจุดูู ุตุญูุญ
- โ `{{recipientName}}` ูุชู ุงุณุชุจุฏุงููุง ุจุดูู ุตุญูุญ

## ๐ง **ุงููููุงุช ุงูุชู ุณูุชู ุชุนุฏูููุง:**

### **1. `src/lib/unifiedEmailService.ts`:**
- โ ุชุญุฏูุซ `sendTemporaryPasswordEmail()` ูุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุถุงูุฉ `processTemplateVariables()`

### **2. `src/lib/databaseEmailService.ts`:**
- โ ุงูุชุฃูุฏ ูู ุฃู `getEmailTemplate()` ูุนูู ุจุดูู ุตุญูุญ

### **3. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- โ ุฅุฏุฑุงุฌ ููุน ุฅุดุนุงุฑ `temporary_password`
- โ ุฅุฏุฑุงุฌ ูุงูุจ `temporary_password` ูุน ุงููุณุฎุชูู

## ๐ **ุงูููุงุฑูุฉ:**

### **ูุจู ุงูุชุญุฏูุซ:**
- โ ุงููุงูุจ ูุฏูุฌ ูู ุงูููุฏ
- โ ูุง ูููู ุชุนุฏููู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- โ ูุง ูููู ุฅุฏุงุฑุฉ ุงููุณุฎุชูู ุจุดูู ูููุตู
- โ ุตุนุจ ุงูุตูุงูุฉ ูุงูุชุทููุฑ

### **ุจุนุฏ ุงูุชุญุฏูุซ:**
- โ ุงููุงูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูููู ุชุนุฏููู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- โ ูููู ุฅุฏุงุฑุฉ ุงููุณุฎุชูู ุจุดูู ูููุตู
- โ ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- โ ูููู ุฅุถุงูุฉ ููุงูุจ ุฌุฏูุฏุฉ ุจุณูููุฉ

## ๐ **ุงูููุงุฆุฏ:**

1. **ุงููุฑููุฉ:** ูููู ุชุนุฏูู ุงูููุงูุจ ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
2. **ุงูุฅุฏุงุฑุฉ:** ูููู ุฅุฏุงุฑุฉ ุงููุณุฎุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ุจุดูู ูููุตู
3. **ุงูุตูุงูุฉ:** ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ
4. **ุงูุชูุณุน:** ูููู ุฅุถุงูุฉ ููุงูุจ ุฌุฏูุฏุฉ ุจุณูููุฉ
5. **ุงูุชุญูู:** ุชุญูู ูุงูู ูู ุงููุญุชูู ูุงูุดูู

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

1. **ุงููุณุฎ ุงูุงุญุชูุงุทู:** ุชุฃูุฏ ูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ุงูุชุญุฏูุซ
2. **ุงูุงุฎุชุจุงุฑ:** ุงุฎุชุจุฑ ุงููุธุงู ุฌูุฏุงู ูุจู ุงููุดุฑ
3. **ุงููุชุบูุฑุงุช:** ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุชุบูุฑุงุช ุชุนูู ุจุดูู ุตุญูุญ
4. **ุงูุชูุงูู:** ุชุฃูุฏ ูู ุฃู ุงููุญุชูู ุงูุฌุฏูุฏ ูุทุงุจู ูููุญุชูู ุงูุญุงูู

## ๐ฏ **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

ุจุนุฏ ุฅููุงู ูุฐู ุงูุฎุทุฉุ ุณูููู ูุงูุจ ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ:
- โ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุงุจู ููุชุนุฏูู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- โ ูุฏุนู ุงููุณุฎุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ ูุนูู ุจููุณ ุงูุทุฑููุฉ ุงูุญุงููุฉ
- โ ูููู ุฅุฏุงุฑุชู ุจุณูููุฉ







