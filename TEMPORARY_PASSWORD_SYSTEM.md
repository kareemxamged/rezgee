# ูุธุงู ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ - ุฑุฒูู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ ููููุน ุฑุฒูู ููุญู ูุญู ูุธุงู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุชูููุฏู. ุจุฏูุงู ูู ุฅุฑุณุงู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนูููุ ูุชู ุฅุฑุณุงู ูููุฉ ูุฑูุฑ ูุคูุชุฉ ุขููุฉ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.

## ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ ุงูุฃูุงู
- **ุชุดููุฑ ููู**: ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ ูุดูุฑุฉ ุจุงุณุชุฎุฏุงู bcrypt ูุน salt rounds = 12
- **ุงูุชูุงุก ุตูุงุญูุฉ**: ูู ูููุฉ ูุฑูุฑ ูุคูุชุฉ ุชูุชูู ุตูุงุญูุชูุง ุฎูุงู 60 ุฏูููุฉ
- **ุงุณุชุฎุฏุงู ูุงุญุฏ**: ูู ูููุฉ ูุฑูุฑ ูุคูุชุฉ ุชูุณุชุฎุฏู ูุฑุฉ ูุงุญุฏุฉ ููุท
- **ุญูุงูุฉ ูู ุงูุชุนุฏุงุฏ**: ุนุฏู ุงููุดู ุนู ูุฌูุฏ ุฃู ุนุฏู ูุฌูุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

### ๐ก๏ธ ุงูุญูุงูุฉ ูู ุงูุฅุณุงุกุฉ
- **ุญุฏ ูููู**: 6 ุทูุจุงุช ูุญุฏ ุฃูุตู ููููุงู ููู ูุณุชุฎุฏู
- **ุญุฏ ุดูุฑู**: 12 ุทูุจ ูุญุฏ ุฃูุตู ุดูุฑูุงู ููู ูุณุชุฎุฏู
- **ูุชุฑุฉ ุงูุชุธุงุฑ**: 5 ุฏูุงุฆู ุจูู ูู ุทูุจ
- **ุญุธุฑ ุชููุงุฆู**: ุญุธุฑ ุงููุณุชุฎุฏููู ุงูุฐูู ูุชุฌุงูุฒูู ุงูุญุฏูุฏ

### ๐ง ุงูุชูุงูู ูุน Supabase
- **SMTP ูุฎุตุต**: ุงุณุชุฎุฏุงู Supabase Custom SMTP (smtp.hostinger.com)
- **Templates ูุญุฏุซุฉ**: ุชู ุชุญุฏูุซ template ุงูู recovery ููุญุชูู ุนูู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
- **ูุชุบูุฑุงุช ุฏููุงููููุฉ**: ุงุณุชุฎุฏุงู {{.Token}} ู {{.ExpiresAt}} ูู Templates

## ุงููููุงุช ุงููุชุฃุซุฑุฉ

### 1. ุฎุฏูุฉ ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- **ุงูููู**: `src/lib/temporaryPasswordService.ts`
- **ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ**:
  - `createTemporaryPassword()`: ุฅูุดุงุก ูููุฉ ูุฑูุฑ ูุคูุชุฉ
  - `verifyTemporaryPassword()`: ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
  - `sendTemporaryPasswordViaSupabase()`: ุฅุฑุณุงู ูููุฉ ุงููุฑูุฑ ุนุจุฑ Supabase
  - `updatePasswordWithTempPassword()`: ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู ุงููุคูุชุฉ

### 2. ุตูุญุฉ ูุณูุช ุงูุจุงุณููุฑุฏ
- **ุงูููู**: `src/components/ForgotPasswordPage.tsx`
- **ุงูุชุญุฏูุซุงุช**:
  - ุงุณุชุฎุฏุงู `sendTemporaryPasswordViaSupabase()` ุจุฏูุงู ูู ุงูุฎุฏูุงุช ุงููุฏููุฉ
  - ุชุจุณูุท ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
  - ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุงุณุชุฎุฏุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ

### 3. ุตูุญุฉ ุงุณุชุฎุฏุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
- **ุงูููู**: `src/components/TemporaryPasswordLoginPage.tsx`
- **ุงููุธุงุฆู**:
  - ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
  - ุชุนููู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
  - ุชุณุฌูู ุงูุฏุฎูู ุงูุชููุงุฆู ุจุนุฏ ุงูุชุญุฏูุซ

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `temporary_passwords`
```sql
CREATE TABLE temporary_passwords (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    email TEXT NOT NULL,
    temp_password_hash TEXT NOT NULL,
    temp_password_plain TEXT, -- ููุงุฎุชุจุงุฑ ููุท
    is_used BOOLEAN DEFAULT FALSE,
    is_first_use BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    used_at TIMESTAMP WITH TIME ZONE,
    ip_address TEXT,
    user_agent TEXT,
    replaced_original BOOLEAN DEFAULT FALSE
);
```

### ุฌุฏูู `password_reset_requests`
```sql
CREATE TABLE password_reset_requests (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    email TEXT NOT NULL,
    daily_requests_count INTEGER DEFAULT 0,
    daily_reset_date DATE DEFAULT CURRENT_DATE,
    last_request_at TIMESTAMP WITH TIME ZONE,
    monthly_requests_count INTEGER DEFAULT 0,
    monthly_reset_date DATE DEFAULT CURRENT_DATE,
    unused_requests_count INTEGER DEFAULT 0,
    is_blocked_until TIMESTAMP WITH TIME ZONE,
    block_reason TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## ุฅุนุฏุงุฏุงุช Supabase

### SMTP Configuration
- **Host**: smtp.hostinger.com
- **Port**: 465
- **User**: manage@kareemamged.com
- **Sender Name**: REZGEE

### Email Templates
- **Recovery Subject**: "ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ - ุฑุฒูู"
- **Recovery Template**: ุชู ุชุญุฏูุซู ููุญุชูู ุนูู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ุจุฏูุงู ูู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุทูุจ ูููุฉ ูุฑูุฑ ูุคูุชุฉ
```typescript
import { sendTemporaryPasswordViaSupabase } from '../lib/temporaryPasswordService';

const result = await sendTemporaryPasswordViaSupabase('user@example.com');
if (result.success) {
    // ุชู ุฅุฑุณุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ุจูุฌุงุญ
    console.log('ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ');
} else {
    // ูุนุงูุฌุฉ ุงูุฎุทุฃ
    console.error(result.error);
}
```

### 2. ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
```typescript
import { verifyTemporaryPassword } from '../lib/temporaryPasswordService';

const result = await verifyTemporaryPassword('user@example.com', 'temp_password');
if (result.isValid && result.isTemporary) {
    // ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ ุตุญูุญุฉ
    console.log('ูููุฉ ุงููุฑูุฑ ุตุญูุญุฉ');
}
```

### 3. ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
```typescript
import { updatePasswordWithTempPassword } from '../lib/temporaryPasswordService';

const result = await updatePasswordWithTempPassword(
    'user@example.com',
    'temp_password',
    'new_password'
);
if (result.success) {
    // ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ
    console.log('ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ');
}
```

## ุงูุฃูุงู ูุงูุญูุงูุฉ

### ุญูุงูุฉ ูู ุงููุฌูุงุช
1. **Rate Limiting**: ุญุฏูุฏ ููููุฉ ูุดูุฑูุฉ ููุทูุจุงุช
2. **Brute Force Protection**: ูุชุฑุงุช ุงูุชุธุงุฑ ุจูู ุงูุทูุจุงุช
3. **Account Enumeration Protection**: ุนุฏู ุงููุดู ุนู ูุฌูุฏ ุงูุญุณุงุจุงุช
4. **Secure Password Generation**: ูููุงุช ูุฑูุฑ ูููุฉ ูุนุดูุงุฆูุฉ

### ุงูุชุดููุฑ
- **bcrypt**: ุชุดููุฑ ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- **Salt Rounds**: 12 rounds ููุญูุงูุฉ ุงููููุฉ
- **Secure Random**: ุชูููุฏ ูููุงุช ูุฑูุฑ ุนุดูุงุฆูุฉ ุขููุฉ

## ุงูุตูุงูุฉ ูุงูุชูุธูู

### ุชูุธูู ุชููุงุฆู
- **ุฏุงูุฉ**: `cleanup_expired_temporary_passwords()`
- **ุงูุชุดุบูู**: ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
- **ุงููุธููุฉ**: ุญุฐู ูููุงุช ุงููุฑูุฑ ุงูููุชููุฉ ุงูุตูุงุญูุฉ ูุงููุณุชุฎุฏูุฉ

### ูุฑุงูุจุฉ ุงููุธุงู
- **Logs**: ุชุณุฌูู ููุตู ูุฌููุน ุงูุนูููุงุช
- **Error Handling**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- **Performance Monitoring**: ูุฑุงูุจุฉ ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ูุดููุฉ Row Level Security (RLS)
- **ุงููุดููุฉ**: ุฎุทุฃ 42501 - ุงูุชูุงู ุณูุงุณุฉ RLS ุนูุฏ ุฅุฏุฑุงุฌ ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- **ุงูุญู**: ุชุญุฏูุซ ุณูุงุณุงุช RLS ููุณูุงุญ ุจุงูุฅุฏุฑุงุฌ ูุงูุชุญุฏูุซ
- **ุงูููุฏ ุงููุทุจู**:
```sql
CREATE POLICY "Allow insert temporary passwords" ON temporary_passwords
    FOR INSERT WITH CHECK (true);
```

### 2. ูุดููุฉ ุงููุตูู ูุฌุฏูู ุงููุณุชุฎุฏููู
- **ุงููุดููุฉ**: ูุญุงููุฉ ุงููุตูู ูุฌุฏูู `users` ูู `public` schema ุจุฏูุงู ูู `auth.users`
- **ุงูุญู**: ุฅูุดุงุก ุฏุงูุฉ `getUserInfo()` ูููุตูู ุงูุตุญูุญ ูููุณุชุฎุฏููู
- **ุงูุชุญุณูู**: ุฏูุฌ ูุนูููุงุช ูู `auth.users` ู `profiles`

### 3. ูุดููุฉ ุฅุนุฏุงุฏุงุช Supabase Templates
- **ุงููุดููุฉ**: Template ุงูู recovery ูุง ูุญุชูู ุนูู ูุชุบูุฑุงุช ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
- **ุงูุญู ุงูุฃูู**: ุชุญุฏูุซ template ููุณุชุฎุฏู `{{.Token}}` ู `{{.ExpiresAt}}`
- **ุงูุญู ุงูููุงุฆู**: ุฅูุดุงุก Edge Function ูุฎุตุต ูุน Resend API
- **ุงููุชูุฌุฉ**: ุฅุฑุณุงู ูููุงุช ูุฑูุฑ ูุคูุชุฉ ูุจุงุดุฑุฉ ุนุจุฑ Resend API

### 4. ูุดููุฉ ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- **ุงููุดููุฉ**: Supabase SMTP ูุง ูุฑุณู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุดูู ููุซูู
- **ุงูุญู**: ุฅูุดุงุก Edge Function `send-temporary-password` ูุณุชุฎุฏู Resend API
- **ุงูููุชุงุญ**: `re_YrvygStJ_EWyFv3jnpzR9BbZP78iA1ZXm`
- **ุงููุชูุฌุฉ**: ุฅุฑุณุงู ููุซูู ููุจุฑูุฏ ุงูุฅููุชุฑููู ูุน ุชุชุจุน ุญุงูุฉ ุงูุฅุฑุณุงู

## ุงูุงุฎุชุจุงุฑุงุช ุงูููุฌุฒุฉ

### 1. ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ (Unit Tests)
- **ุงูููู**: `src/tests/temporaryPasswordSystem.test.ts`
- **ุงูุชุบุทูุฉ**: ุฌููุน ุงูุฏูุงู ุงูุฑุฆูุณูุฉ
- **ุงูุฃุฏูุงุช**: Vitest, Mock Supabase, Mock bcrypt

### 2. ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู
- **ุงููุทุงู**: ุงูุชุฏูู ุงููุงูู ูู ุฅูุดุงุก ุฅูู ุงุณุชุฎุฏุงู ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
- **ุงูุจูุฆุฉ**: ูุงุนุฏุฉ ุจูุงูุงุช ุงุฎุชุจุงุฑ ูููุตูุฉ
- **ุงูุณููุงุฑูููุงุช**: ุญุงูุงุช ุงููุฌุงุญ ูุงููุดู

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ุชุญุณููุงุช ูุฎุทุทุฉ
1. **SMS Support**: ุฅุถุงูุฉ ุฏุนู ุฅุฑุณุงู ูููุงุช ุงููุฑูุฑ ุนุจุฑ SMS
2. **Multi-language Templates**: ููุงูุจ ูุชุนุฏุฏุฉ ุงููุบุงุช
3. **Advanced Analytics**: ุชุญูููุงุช ูุชูุฏูุฉ ูุงุณุชุฎุฏุงู ุงููุธุงู
4. **Mobile App Integration**: ุชูุงูู ูุน ุชุทุจูู ุงููุงุชู ุงููุญููู

### ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ ูุทููุจุฉ
1. **Load Testing**: ุงุฎุชุจุงุฑุงุช ุงูุญูููุฉ ุงูุนุงููุฉ
2. **Security Penetration**: ุงุฎุชุจุงุฑุงุช ุงุฎุชุฑุงู ุงูุฃูุงู
3. **Cross-browser Testing**: ุงุฎุชุจุงุฑุงุช ูุชุนุฏุฏุฉ ุงููุชุตูุญุงุช
4. **Mobile Responsiveness**: ุงุฎุชุจุงุฑุงุช ุงูุงุณุชุฌุงุจุฉ ููููุงุชู

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: support@rezge.com
- **ุงูุชูุซูู**: ุฑุงุฌุน ูุฐุง ุงูููู ููุชูุงุตูู ุงููุงููุฉ
- **ุงูููุฏ ุงููุตุฏุฑู**: `src/lib/temporaryPasswordService.ts`

## ุญุงูุฉ ุงููุธุงู ุงูุญุงููุฉ

### โ ููุชูู ููุนูู
- [x] ุฅูุดุงุก ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- [x] ุชุดููุฑ ูุญูุธ ูููุงุช ุงููุฑูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [x] ุฅุฑุณุงู ูููุงุช ุงููุฑูุฑ ุนุจุฑ Resend API (Edge Function)
- [x] ุงูุชุญูู ูู ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- [x] ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู ุงููุคูุชุฉ
- [x] ุญูุงูุฉ ูู ุงูุฅุณุงุกุฉ ูุงูุญุฏูุฏ ุงูููููุฉ/ุงูุดูุฑูุฉ
- [x] ุณูุงุณุงุช RLS ูุญุฏุซุฉ ูุชุนูู ุจุดูู ุตุญูุญ
- [x] Edge Function `send-temporary-password` ููุดูุฑ ููุนูู
- [x] ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ูููุธุงู
- [x] ุชูุงูู ูุน Resend API ููุฅุฑุณุงู ุงูููุซูู

### ๐ ููุฏ ุงูุชุทููุฑ
- [ ] ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ ูุชุฑุฌูุชูุง
- [ ] ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู
- [ ] ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ๐ ุฎุทูุงุช ุงูุชุดุบูู
1. **ุชุฃูุฏ ูู Edge Function**: `send-temporary-password` ููุดูุฑ ูู Supabase
2. **ุชุญูู ูู Resend API**: ุงูููุชุงุญ `re_YrvygStJ_EWyFv3jnpzR9BbZP78iA1ZXm` ูุนูู
3. **ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช**: `npm test temporaryPasswordSystem.test.ts`
4. **ุงุฎุชุจุงุฑ ุงููุธููุฉ**: ุงุณุชุฎุฏู ุตูุญุฉ "ูุณูุช ุงูุจุงุณููุฑุฏ"
5. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ุชุญูู ูู logs ูู Supabase Dashboard

### ูุนูููุงุช ุชูููุฉ
- **Edge Function ID**: `2b2d9627-7667-43e7-9f0f-477b6c0a4ec2`
- **Function Slug**: `send-temporary-password`
- **Resend API Key**: `re_YrvygStJ_EWyFv3jnpzR9BbZP78iA1ZXm`
- **From Email**: `manage@kareemamged.com`
- **CORS**: ูููุนู ูุฌููุน ุงููุตุงุฏุฑ

---

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ**: 2025-01-14
**ุงูุฅุตุฏุงุฑ**: 1.1.0
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ ูููุฎุชุจุฑ
**ุงููุทูุฑ**: ูุฑูู ุฑุฒูู ุงูุชููู
**Edge Function**: `send-temporary-password` (ูุดุท)
**API Provider**: Resend API (ููุซูู)
