<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة حذف طلبات كلمة المرور المؤقتة - رزقي</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .tool-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }
        
        .tool-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-left: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }
        
        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(81, 207, 102, 0.4);
        }
        
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
            direction: ltr;
            text-align: left;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .warning strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 أداة حذف طلبات كلمة المرور المؤقتة</h1>
            <p>إدارة وحذف طلبات إعادة تعيين كلمة المرور - موقع رزقي</p>
        </div>
        
        <div class="content">
            <div class="warning">
                <strong>⚠️ تحذير مهم:</strong>
                هذه الأداة تحذف طلبات إعادة تعيين كلمة المرور من قاعدة البيانات. استخدمها بحذر وتأكد من الإيميل قبل الحذف.
            </div>
            
            <div id="status" class="status loading">
                ⏳ جاري تحميل الأداة...
            </div>
            
            <!-- أداة فحص الطلبات -->
            <div class="tool-section">
                <h3>🔍 فحص طلبات كلمة المرور المؤقتة</h3>
                <div class="input-group">
                    <label for="checkEmail">البريد الإلكتروني:</label>
                    <input type="email" id="checkEmail" placeholder="أدخل البريد الإلكتروني للفحص" value="moxamgad@gmail.com">
                </div>
                <button class="btn btn-success" onclick="checkRequests()">🔍 فحص الطلبات</button>
            </div>
            
            <!-- أداة حذف الطلبات -->
            <div class="tool-section">
                <h3>🗑️ حذف طلبات كلمة المرور المؤقتة</h3>
                <div class="input-group">
                    <label for="clearEmail">البريد الإلكتروني:</label>
                    <input type="email" id="clearEmail" placeholder="أدخل البريد الإلكتروني للحذف" value="moxamgad@gmail.com">
                </div>
                <button class="btn btn-danger" onclick="clearRequests()">🗑️ حذف الطلبات</button>
                <button class="btn btn-danger" onclick="clearAllData()">🧹 تنظيف شامل</button>
            </div>
            
            <!-- أدوات سريعة -->
            <div class="tool-section">
                <h3>⚡ أدوات سريعة</h3>
                <button class="btn" onclick="clearConsole()">🧹 مسح الكونسول</button>
                <button class="btn" onclick="showHelp()">❓ المساعدة</button>
            </div>
            
            <!-- مخرجات الكونسول -->
            <div id="console" class="console-output">
                جاري تحميل الأداة...
            </div>
        </div>
    </div>

    <script>
        let consoleElement = document.getElementById('console');
        let statusElement = document.getElementById('status');
        
        // إعادة توجيه console.log إلى العنصر
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            consoleElement.textContent += message + '\n';
            consoleElement.scrollTop = consoleElement.scrollHeight;
        };
        
        // تحديث حالة الأداة
        function updateStatus(message, type = 'loading') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        // فحص الطلبات
        async function checkRequests() {
            const email = document.getElementById('checkEmail').value.trim();
            if (!email) {
                alert('يرجى إدخال البريد الإلكتروني');
                return;
            }
            
            updateStatus('🔍 جاري فحص الطلبات...', 'loading');
            console.log('='.repeat(50));
            console.log(`🔍 فحص طلبات: ${email}`);
            console.log('='.repeat(50));
            
            try {
                const result = await window.checkPasswordResetRequests(email);
                if (result.success) {
                    updateStatus('✅ تم الفحص بنجاح', 'success');
                } else {
                    updateStatus('❌ فشل الفحص', 'error');
                }
            } catch (error) {
                console.log('❌ خطأ:', error.message);
                updateStatus('❌ خطأ في الفحص', 'error');
            }
        }
        
        // حذف الطلبات
        async function clearRequests() {
            const email = document.getElementById('clearEmail').value.trim();
            if (!email) {
                alert('يرجى إدخال البريد الإلكتروني');
                return;
            }
            
            if (!confirm(`هل أنت متأكد من حذف طلبات كلمة المرور المؤقتة لـ: ${email}؟`)) {
                return;
            }
            
            updateStatus('🗑️ جاري حذف الطلبات...', 'loading');
            console.log('='.repeat(50));
            console.log(`🗑️ حذف طلبات: ${email}`);
            console.log('='.repeat(50));
            
            try {
                const result = await window.clearPasswordResetRequests(email);
                if (result.success) {
                    updateStatus('✅ تم الحذف بنجاح', 'success');
                } else {
                    updateStatus('❌ فشل الحذف', 'error');
                }
            } catch (error) {
                console.log('❌ خطأ:', error.message);
                updateStatus('❌ خطأ في الحذف', 'error');
            }
        }
        
        // تنظيف شامل
        async function clearAllData() {
            const email = document.getElementById('clearEmail').value.trim();
            if (!email) {
                alert('يرجى إدخال البريد الإلكتروني');
                return;
            }
            
            if (!confirm(`هل أنت متأكد من التنظيف الشامل لجميع بيانات كلمة المرور لـ: ${email}؟\n\nسيتم حذف:\n- طلبات إعادة تعيين كلمة المرور\n- محاولات تسجيل الدخول\n- حالات الحظر`)) {
                return;
            }
            
            updateStatus('🧹 جاري التنظيف الشامل...', 'loading');
            console.log('='.repeat(50));
            console.log(`🧹 تنظيف شامل: ${email}`);
            console.log('='.repeat(50));
            
            try {
                const result = await window.clearAllPasswordResetData(email);
                if (result.success) {
                    updateStatus('✅ تم التنظيف الشامل بنجاح', 'success');
                } else {
                    updateStatus('❌ فشل التنظيف الشامل', 'error');
                }
            } catch (error) {
                console.log('❌ خطأ:', error.message);
                updateStatus('❌ خطأ في التنظيف الشامل', 'error');
            }
        }
        
        // مسح الكونسول
        function clearConsole() {
            consoleElement.textContent = '';
            console.log('🧹 تم مسح الكونسول');
        }
        
        // المساعدة
        function showHelp() {
            console.log('='.repeat(50));
            console.log('❓ مساعدة الأداة');
            console.log('='.repeat(50));
            console.log('🔍 فحص الطلبات: يعرض تفاصيل طلبات كلمة المرور المؤقتة');
            console.log('🗑️ حذف الطلبات: يحذف طلبات إعادة تعيين كلمة المرور فقط');
            console.log('🧹 تنظيف شامل: يحذف جميع البيانات المتعلقة بكلمة المرور');
            console.log('');
            console.log('💡 نصائح:');
            console.log('- تأكد من الإيميل قبل الحذف');
            console.log('- استخدم الفحص أولاً لمعرفة حالة الطلبات');
            console.log('- التنظيف الشامل يحذف جميع القيود والحظر');
            console.log('='.repeat(50));
        }
        
        // تحديث الحالة عند تحميل الصفحة
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (window.clearPasswordResetRequests) {
                    updateStatus('✅ الأداة جاهزة للاستخدام', 'success');
                    console.log('✅ الأداة جاهزة! يمكنك الآن استخدام الأزرار أعلاه');
                } else {
                    updateStatus('❌ فشل تحميل الأداة', 'error');
                    console.log('❌ فشل تحميل الأداة. تحقق من الاتصال بالإنترنت');
                }
            }, 2000);
        });
    </script>
    
    <!-- تحميل أداة حذف طلبات كلمة المرور -->
    <script src="clear-password-reset-requests.js"></script>
</body>
</html>
