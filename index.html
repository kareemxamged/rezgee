<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/main.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/main-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/main-32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/main-96.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
    <title>ุฑุฒูู - ูููุน ุงูุฒูุงุฌ ุงูุฅุณูุงูู</title>
</head>

<body>
    <div id="root"></div>

    <!-- ูุนุงูุฌ ุฃุฎุทุงุก ุฅุถุงูุงุช ุงููุชุตูุญ -->
    <script>
        (function() {
            'use strict';

            // ูุงุฆูุฉ ุจุฃุณูุงุก ูููุงุช ุงูุฅุถุงูุงุช ุงูุดุงุฆุนุฉ
            const extensionFiles = [
                'content_script',
                'contentscript',
                'background',
                'inject',
                'extension',
                'chrome-extension',
                'moz-extension'
            ];

            // ูุงุฆูุฉ ุจุฑุณุงุฆู ุฃุฎุทุงุก ุงูุฅุถุงูุงุช ุงูุดุงุฆุนุฉ
            const extensionErrorMessages = [
                'FrameDoesNotExistError',
                'Frame does not exist',
                'runtime.lastError',
                'Could not establish connection',
                'Receiving end does not exist',
                'message port closed',
                'back/forward cache',
                'Extension context invalidated',
                'message channel is closed'
            ];

            // ูุนุงูุฌ ุงูุฃุฎุทุงุก ุงูุนุงู
            window.addEventListener('error', function(event) {
                const errorMessage = event.message || '';
                const filename = event.filename || '';

                // ูุญุต ุงุณู ุงูููู
                const isExtensionFile = extensionFiles.some(file =>
                    filename.toLowerCase().includes(file)
                );

                // ูุญุต ุฑุณุงูุฉ ุงูุฎุทุฃ
                const isExtensionMessage = extensionErrorMessages.some(msg =>
                    errorMessage.toLowerCase().includes(msg.toLowerCase())
                );

                if (isExtensionFile || isExtensionMessage) {
                    console.warn('๐ง ุชู ุชุฌุงูู ุฎุทุฃ ูู ุฅุถุงูุฉ ูุชุตูุญ:', {
                        message: errorMessage,
                        filename: filename,
                        lineno: event.lineno,
                        type: isExtensionFile ? 'extension-file' : 'extension-message'
                    });
                    event.preventDefault();
                    return true;
                }
            }, true);

            // ูุนุงูุฌ ุงูุฃุฎุทุงุก ุบูุฑ ุงููุนุงูุฌุฉ
            window.addEventListener('unhandledrejection', function(event) {
                const reason = event.reason;
                let reasonText = '';

                if (reason) {
                    if (typeof reason === 'string') {
                        reasonText = reason;
                    } else if (reason.message) {
                        reasonText = reason.message;
                    } else if (reason.stack) {
                        reasonText = reason.stack;
                    } else {
                        reasonText = String(reason);
                    }
                }

                // ูุญุต ุงุณู ุงูููู ูู stack trace
                const isExtensionFile = extensionFiles.some(file =>
                    reasonText.toLowerCase().includes(file)
                );

                // ูุญุต ุฑุณุงูุฉ ุงูุฎุทุฃ
                const isExtensionMessage = extensionErrorMessages.some(msg =>
                    reasonText.toLowerCase().includes(msg.toLowerCase())
                );

                if (isExtensionFile || isExtensionMessage) {
                    console.warn('๐ง ุชู ุชุฌุงูู Promise rejection ูู ุฅุถุงูุฉ ูุชุตูุญ:', {
                        reason: reason,
                        type: isExtensionFile ? 'extension-file' : 'extension-message'
                    });
                    event.preventDefault();
                    return true;
                }
            });

            // ุญูุงูุฉ MutationObserver ูู ุงูุชุฏุงุฎู
            const originalMutationObserver = window.MutationObserver;
            if (originalMutationObserver) {
                window.MutationObserver = function(callback) {
                    return new originalMutationObserver(function(mutations, observer) {
                        try {
                            callback.call(this, mutations, observer);
                        } catch (error) {
                            if (error.message && error.message.includes('deref')) {
                                console.warn('๐ง ุชู ุชุฌุงูู ุฎุทุฃ MutationObserver ูู ุฅุถุงูุฉ:', error.message);
                                return;
                            }
                            throw error;
                        }
                    });
                };
            }

            // ูุนุงูุฌ ุฎุงุต ูุฃุฎุทุงุก runtime.lastError
            const originalConsoleError = console.error;
            console.error = function(...args) {
                const message = args.join(' ');

                // ูุญุต ุฑุณุงุฆู runtime.lastError
                const isRuntimeError = extensionErrorMessages.some(msg =>
                    message.toLowerCase().includes(msg.toLowerCase())
                );

                if (isRuntimeError) {
                    console.warn('๐ง ุชู ุชุฌุงูู runtime.lastError ูู ุฅุถุงูุฉ ูุชุตูุญ:', message);
                    return;
                }

                // ุงุณุชุฏุนุงุก console.error ุงูุฃุตูู ููุฃุฎุทุงุก ุงูุฃุฎุฑู
                originalConsoleError.apply(console, args);
            };
        })();
    </script>

    <script type="module" src="/src/main.tsx"></script>
</body>

</html>