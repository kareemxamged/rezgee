@echo off
title ุฑุฒูู - ูููุน ุงูุฒูุงุฌ ุงูุฅุณูุงูู
color 0A

echo.
echo     โโโโโโโ โโโโโโโโโโโโโโโโ โโโโโโโ โโโโโโโโ
echo     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโ
echo     โโโโโโโโโโโโโโ    โโโโโ โโโ  โโโโโโโโโโ  
echo     โโโโโโโโโโโโโโ   โโโโโ  โโโ   โโโโโโโโโ  
echo     โโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo     โโโ  โโโโโโโโโโโโโโโโโโโ โโโโโโโ โโโโโโโโ
echo.
echo     ๐ ูููุน ุงูุฒูุงุฌ ุงูุฅุณูุงูู - ุฑุฒูู ๐
echo     ================================
echo.

REM ุงูุชุญูู ูู ูุฌูุฏ Node.js
echo [1/4] ๐ ุงูุชุญูู ูู Node.js...
node --version >nul 2>&1
if %errorlevel% neq 0 (
    echo โ Node.js ุบูุฑ ูุซุจุช!
    echo ๐ฅ ูุฑุฌู ุชุซุจูุช Node.js ูู: https://nodejs.org
    echo.
    pause
    exit /b 1
)
echo โ Node.js ูุชููุฑ

REM ุชุซุจูุช ุงูููุชุจุงุช
echo [2/4] ๐ฆ ุชุซุจูุช ุงูููุชุจุงุช...
if not exist "node_modules" (
    echo ๐ ุชุซุจูุช ููุชุจุงุช ุงููุดุฑูุน...
    npm install
    if %errorlevel% neq 0 (
        echo โ ูุดู ูู ุชุซุจูุช ุงูููุชุจุงุช
        pause
        exit /b 1
    )
) else (
    echo โ ุงูููุชุจุงุช ูุชููุฑุฉ
)

REM ุชุซุจูุช ููุชุจุงุช SMTP
echo [3/4] ๐ง ุชุญุถูุฑ ุฎุงุฏู SMTP...
npm list nodemailer >nul 2>&1
if %errorlevel% neq 0 (
    echo ๐ ุชุซุจูุช ููุชุจุงุช SMTP...
    npm install nodemailer cors concurrently
    if %errorlevel% neq 0 (
        echo โ ูุดู ูู ุชุซุจูุช ููุชุจุงุช SMTP
        pause
        exit /b 1
    )
)
echo โ ุฎุงุฏู SMTP ุฌุงูุฒ

REM ุชูุธูู ุงูุนูููุงุช ุงูุณุงุจูุฉ
echo [4/4] ๐งน ุชูุธูู ุงูุนูููุงุช ุงูุณุงุจูุฉ...
for /f "tokens=5" %%a in ('netstat -ano ^| find "5173" ^| find "LISTENING"') do (
    taskkill /PID %%a /F >nul 2>&1
)
for /f "tokens=5" %%a in ('netstat -ano ^| find "3001" ^| find "LISTENING"') do (
    taskkill /PID %%a /F >nul 2>&1
)
timeout /t 1 >nul
echo โ ุชู ุงูุชูุธูู

echo.
echo ================================================
echo ๐ ุจุฏุก ุชุดุบูู ูุดุฑูุน ุฑุฒูู
echo ================================================
echo ๐ฑ ุงูุชุทุจูู ุงูุฑุฆูุณู: http://localhost:5173
echo ๐ง ุฎุงุฏู SMTP: http://localhost:3001
echo ๐งช ุตูุญุฉ ุงูุงุฎุชุจุงุฑ: test-independent-smtp.html
echo ================================================
echo.
echo ๐ก ูุตุงุฆุญ:
echo    โข ุงุณุชุฎุฏู ุตูุญุฉ "ูุณูุช ุงูุจุงุณููุฑุฏ" ูุงุฎุชุจุงุฑ ุงูุฅุฑุณุงู
echo    โข ุฑุงูุจ ุงููููุณูู ูุฑุคูุฉ ุชูุงุตูู ุงูุฅุฑุณุงู
echo    โข ูุฅููุงู ุงูุฎูุงุฏู: ุงุถุบุท Ctrl+C
echo.
echo ๐ฏ ุฌุงุฑู ุงูุชุดุบูู...

REM ุชุดุบูู ุงููุดุฑูุน
npm run dev

echo.
echo ๐ ุชู ุฅููุงู ุงูุฎูุงุฏู
pause
