import { UnifiedEmailService } from './unifiedEmailService';

/**
 * Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
 * ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
 */
export class DirectNotificationEmailService {
  /**
   * Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚
   */
  static async sendVerificationStatusNotificationEmail(
    userId: string,
    status: 'approved' | 'rejected',
    notes?: string
  ): Promise<{ success: boolean; error?: string }> {
    try {
      console.log('ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚...');
      console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}`);
      console.log(`ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø©: ${status}`);

      // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
      let templateType: 'verification_approved' | 'verification_rejected';
      let emailData: any;

      if (status === 'approved') {
        templateType = 'verification_approved';
        emailData = {
          firstName: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
          notes: notes || 'ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­'
        };
      } else {
        templateType = 'verification_rejected';
        emailData = {
          firstName: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
          rejectionReason: notes || 'Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚'
        };
      }

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
      const result = await UnifiedEmailService.sendEmail({
        to: 'user@example.com', // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        subject: status === 'approved' 
          ? 'ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ - Ø±Ø²Ù‚ÙŠ'
          : 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ - Ø±Ø²Ù‚ÙŠ',
        html: '',
        text: '',
        type: templateType
      }, templateType, 'ar');

      if (result.success) {
        console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        return { success: true };
      } else {
        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚:', result.error);
        return { success: false, error: result.error };
      }

    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚:', error);
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„'
      };
    }
  }

  /**
   * Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø¹Ø¬Ø§Ø¨
   */
  static async sendLikeNotificationEmail(
    userId: string,
    likedByUserId: string,
    likedByName: string
  ): Promise<{ success: boolean; error?: string }> {
    try {
      console.log('ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø¹Ø¬Ø§Ø¨...');
      console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}`);
      console.log(`â¤ï¸ Ø£Ø¹Ø¬Ø¨ Ø¨Ù‡: ${likedByName}`);

      const emailData = {
        firstName: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        likedByName: likedByName,
        profileUrl: `${typeof window !== 'undefined' ? window.location.origin : 'https://rezge.vercel.app'}/profile/${likedByUserId}`
      };

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
      const result = await UnifiedEmailService.sendEmail({
        to: 'user@example.com', // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        subject: `Ù„Ø¯ÙŠÙƒ Ø¥Ø¹Ø¬Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${likedByName} - Ø±Ø²Ù‚ÙŠ`,
        html: '',
        text: '',
        type: 'like_notification'
      }, 'like_notification', 'ar');

      if (result.success) {
        console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        return { success: true };
      } else {
        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨:', result.error);
        return { success: false, error: result.error };
      }

    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨:', error);
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„'
      };
    }
  }

  /**
   * Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
   */
  static async sendMessageNotificationEmail(
    userId: string,
    senderUserId: string,
    senderName: string,
    messagePreview: string
  ): Promise<{ success: boolean; error?: string }> {
    try {
      console.log('ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©...');
      console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}`);
      console.log(`ğŸ’¬ Ù…Ù†: ${senderName}`);

      const emailData = {
        firstName: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        senderName: senderName,
        messagePreview: messagePreview,
        chatUrl: `${typeof window !== 'undefined' ? window.location.origin : 'https://rezge.vercel.app'}/chat/${senderUserId}`
      };

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
      const result = await UnifiedEmailService.sendEmail({
        to: 'user@example.com', // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        subject: `Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${senderName} - Ø±Ø²Ù‚ÙŠ`,
        html: '',
        text: '',
        type: 'message_notification'
      }, 'message_notification', 'ar');

      if (result.success) {
        console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        return { success: true };
      } else {
        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', result.error);
        return { success: false, error: result.error };
      }

    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„'
      };
    }
  }

  /**
   * Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± ØªØ·Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯
   */
  static async sendMatchNotificationEmail(
    userId: string,
    matchedUserId: string,
    matchedUserName: string
  ): Promise<{ success: boolean; error?: string }> {
    try {
      console.log('ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± ØªØ·Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯...');
      console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId}`);
      console.log(`ğŸ’• ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹: ${matchedUserName}`);

      const emailData = {
        firstName: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        matchedUserName: matchedUserName,
        profileUrl: `${typeof window !== 'undefined' ? window.location.origin : 'https://rezge.vercel.app'}/profile/${matchedUserId}`
      };

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
      const result = await UnifiedEmailService.sendEmail({
        to: 'user@example.com', // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        subject: `ØªØ·Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ${matchedUserName} - Ø±Ø²Ù‚ÙŠ`,
        html: '',
        text: '',
        type: 'match_notification'
      }, 'match_notification', 'ar');

      if (result.success) {
        console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø¨Ù†Ø¬Ø§Ø­');
        return { success: true };
      } else {
        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ·Ø§Ø¨Ù‚:', result.error);
        return { success: false, error: result.error };
      }

    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ·Ø§Ø¨Ù‚:', error);
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„'
      };
    }
  }
}